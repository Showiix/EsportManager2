# 财政系统

## 概述

财政系统管理球队的收入、支出和财务状态。保持健康的财政状况是球队生存和发展的关键。

## 货币单位

- 游戏内部使用 **元**
- 显示时转换为 **万元**

## 收入来源

| 收入项 | 计算方式 | 发放时机 | 说明 |
|--------|---------|---------|------|
| 联盟分成 | 固定500万/赛季 | 赛季开始 | 所有球队相同 |
| 赛区排名奖金 | 根据常规赛排名 | 常规赛结束 | 第1名200万，递减 |
| 季后赛奖金 | 根据季后赛名次 | 季后赛结束 | 冠军300万 |
| 国际赛奖金 | MSI/世界赛成绩 | 赛事结束 | 冠军500万 |
| 周边收入 | 基于人气值 | 每赛季结算 | 0-300万浮动 |
| 转会收入 | 卖出选手 | 交易完成 | 转会费100% |

### 主要奖金池

| 赛事 | 奖金池 | 冠军奖金 |
|------|--------|---------|
| MSI | 4000万 | 2000万 (50%) |
| 世界赛 | 1.2亿 | 5000万 (41.67%) |
| Super洲际赛 | 1.5亿 | 6000万 (40%) |
| 马德里大师赛 | 2000万 | 800万 (40%) |
| Claude洲际赛 | 2000万 | 800万 (40%) |
| 上海大师赛 | 2500万 | 1000万 (40%) |
| ICP洲际赛 | 3000万 | 1200万 (40%) |

## 支出项目

| 支出项 | 计算方式 | 扣除时机 | 说明 |
|--------|---------|---------|------|
| 选手薪资 | 各选手薪资总和 | 每赛季开始 | 最大支出项 |
| 转会费 | 购买选手费用 | 交易完成 | 一次性支出 |
| 运营成本 | 固定100万/赛季 | 赛季开始 | 基础开销 |
| 训练设施 | 可选投资 | 主动升级时 | 提升选手成长 |
| 违约金 | 提前解约时 | 解约时 | 剩余薪资的50% |

## 薪资体系

| 能力值区间 | 年薪范围(万) | 说明 |
|-----------|------------|------|
| 90-100 | 200-400 | 顶级巨星 |
| 80-89 | 100-200 | 核心球员 |
| 70-79 | 50-100 | 主力球员 |
| 60-69 | 20-50 | 轮换球员 |
| 60以下 | 10-20 | 替补/新秀 |

### 薪资上限（可选规则）

- 每队总薪资上限: 1500万/赛季
- 单人薪资上限: 400万/赛季
- 超出部分征收奢侈税（超出金额的150%）

## 财政状态

| 状态 | 资金范围 | 影响 |
|-----|---------|------|
| 富裕 | 1000万以上 | 可自由引援 |
| 健康 | 500-1000万 | 正常运营 |
| 紧张 | 100-500万 | 限制高薪签约 |
| 赤字 | 0-100万 | 必须出售选手 |
| 破产 | 负数 | 强制出售最高薪选手 |

## 财政AI决策

### 富裕状态
- 积极引援补强
- 愿意支付溢价抢人
- 给核心续约加薪

### 健康状态
- 正常参与转会市场
- 按市场价交易
- 维持现有阵容

### 紧张状态
- 谨慎引援，优先性价比
- 考虑出售高薪低能选手
- 不主动加薪

### 赤字状态
- 必须出售选手回血
- 挂牌价可降至身价60%
- 不参与任何买入

### 破产状态
- 系统强制出售最高薪选手
- 直到资金转正为止
- 严重影响球队竞争力

## 交易类型

```rust
pub enum TransactionType {
    LeagueShare,        // 联盟分成
    RankingBonus,       // 排名奖金
    PlayoffBonus,       // 季后赛奖金
    InternationalBonus, // 国际赛奖金
    Merchandise,        // 周边收入
    TransferIn,         // 转会收入
    Salary,             // 选手薪资
    TransferOut,        // 转会支出
    OperatingCost,      // 运营成本
    Facility,           // 设施投资
    Penalty,            // 违约金
    LuxuryTax,          // 奢侈税
}
```

## 财务摘要

```rust
pub struct TeamFinanceSummary {
    pub team_id: u64,
    pub balance: i64,                  // 当前余额
    pub total_income: u64,
    pub total_expense: u64,
    pub financial_status: String,
    pub is_crisis: bool,
    pub transfer_budget: i64,          // 转会预算
    pub max_new_salary: u64,           // 最大可承受薪资
    pub projected_season_profit: i64,  // 预计赛季盈亏
    pub total_salary: u64,             // 总薪资支出
}
```

## API 接口

| 接口 | 描述 |
|------|------|
| `get_team_finance_summary(team_id)` | 获取战队财务摘要 |
| `get_team_transactions(team_id, season_id)` | 获取交易记录 |
| `get_season_finance_report(team_id, season_id)` | 获取赛季财务报告 |
| `get_all_teams_finance_summary()` | 获取所有战队财务 |
| `distribute_prize_money(tournament_id)` | 分发奖金 |

## 文件位置

| 文件 | 说明 |
|------|------|
| `src-tauri/src/engines/financial.rs` | 财政引擎 |
| `src-tauri/src/commands/finance_commands.rs` | 财政命令接口 |
