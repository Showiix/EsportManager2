# 转会系统

## 概述

转会系统管理选手的合同、转会和球员交易。采用8轮制的自动转会决策，由AI性格驱动。

## 转会窗口

转会窗口在每个赛季结束后开放：

```
赛季结束 → 转会窗口开放 → 8轮转会 → 选秀 → 新赛季开始
```

## 8轮转会流程

| 轮次 | 名称 | 说明 |
|------|------|------|
| 1 | 赛季结算 | 年龄/能力更新 |
| 2 | 续约谈判 | 合同到期选手续约 |
| 3 | 双向评估 | 球队和选手互相评估 |
| 4 | 自由球员竞标 | 对自由球员进行竞标 |
| 5 | 合同选手转会 | 在役选手转会 |
| 6 | 财务调整 | 处理财务问题 |
| 7 | 最终补救 | 阵容不足的球队补强 |
| 8 | 选秀权拍卖 | 选秀权交易 |

## 转会类型

| 类型 | 触发条件 | 说明 |
|------|----------|------|
| 合同到期 | 合同剩余0年 | 选手变为自由球员，无需转会费 |
| 主动求购 | AI判断需要补强 | 球队向其他球队报价 |
| 被动出售 | 财政困难/选手冗余 | 球队挂牌出售选手 |
| 退役 | 年龄过大/能力过低 | 选手离开职业圈 |
| 租借 | 替补选手外借 | 临时转会，赛季结束归还 |

## 转会意愿计算

```
转会意愿评分 = 基础分
    + 球队实力差 × 15
    + 薪资提升比 × 20
    + 上场机会差 × 10
    + 荣誉差距 × 8
    + 球队声望差 × 5
    - 忠诚度 × 0.3
    - 合同年限 × 3
    + 随机波动(-5~5)
```

**意愿等级**:
| 分数 | 等级 |
|------|------|
| 90-100 | 非常愿意 |
| 70-89 | 愿意 |
| 50-69 | 中立 |
| 30-49 | 犹豫 |
| 0-29 | 拒绝 |

## AI球队性格系统

```rust
pub enum AITeamPersonality {
    Aggressive,      // 激进型 - 高价买人，追求即战力
    Conservative,    // 保守型 - 注重青训，不轻易买人
    Balanced,        // 均衡型 - 平衡当下和未来
    Development,     // 发展型 - 重视年轻选手
    WinNow,          // 即战力型 - 追求当下成绩
}
```

### 性格影响

| 性格 | 短期权重 | 长期权重 | 风险承受 | 年轻偏好 |
|------|---------|---------|---------|---------|
| Aggressive | 高 | 低 | 高 | 低 |
| Conservative | 低 | 高 | 低 | 中 |
| Balanced | 中 | 中 | 中 | 中 |
| Development | 低 | 高 | 中 | 高 |
| WinNow | 高 | 低 | 高 | 低 |

## 转会费计算

```
转会费 = 身价 × 供需系数 × 市场热度系数 × 合同系数
```

| 系数 | 范围 | 说明 |
|------|------|------|
| 供需系数 | 0.8-1.3 | 供大于求降价，供不应求涨价 |
| 市场热度 | 0.9-1.2 | 热门期涨价 |
| 合同系数 | 1.0-1.2 | 长合同涨价 |

## 球队声望系统

```rust
pub struct TeamReputation {
    pub team_id: u64,
    pub historical_score: u32,      // 历史声望 (0-100)
    pub recent_score: u32,          // 近期声望 (0-100)
    pub international_score: u32,   // 国际声望 (0-100)
    pub overall_score: u32,         // 综合声望 (0-100)
}
```

**声望计算规则**:
- 历史声望: 累计荣誉（冠军+20, 亚军+10, 季军+5）
- 近期声望: 最近3个赛季成绩
- 国际声望: 国际赛荣誉（每项+15）
- 综合声望: 历史×30% + 近期×40% + 国际×30%

## 自由球员市场

合同到期选手自动进入自由球员市场：

- 无需转会费，只需支付薪资
- 多支球队可同时报价
- 选手选择因素:
  - 薪资高低 (40%)
  - 球队竞争力 (30%)
  - 上场机会 (20%)
  - 随机因素 (10%)

## API 接口

| 接口 | 描述 |
|------|------|
| `get_transfer_list()` | 获取转会名单 |
| `initiate_transfer(params)` | 发起转会 |
| `accept_transfer(offer_id)` | 接受报价 |
| `reject_transfer(offer_id)` | 拒绝报价 |
| `terminate_contract(player_id)` | 解约 |
| `loan_player(params)` | 租借球员 |
| `get_team_reputation(team_id)` | 获取球队声望 |
| `update_team_personality(team_id, personality)` | 更新球队性格 |

## 文件位置

| 文件 | 说明 |
|------|------|
| `src-tauri/src/engines/transfer.rs` | 转会引擎 |
| `src-tauri/src/commands/transfer_commands.rs` | 转会命令接口 |
