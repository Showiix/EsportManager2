<template>
  <div class="llm-transfer-market">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header">
      <div>
        <h1>LLM è½¬ä¼šå¸‚åœº</h1>
        <p>{{ currentSeason }} èµ›å­£ - {{ currentPhaseName }}</p>
      </div>
      <div class="header-actions">
        <el-button text @click="showGuide = !showGuide">
          <el-icon><QuestionFilled /></el-icon>
          {{ showGuide ? 'æ”¶èµ·è¯´æ˜' : 'ä½¿ç”¨è¯´æ˜' }}
        </el-button>
        <el-tag :type="phaseTagType" size="large" effect="dark">
          {{ currentPhaseName }}
        </el-tag>
      </div>
    </div>

    <!-- ä½¿ç”¨è¯´æ˜ -->
    <el-collapse-transition>
      <el-card v-if="showGuide" class="guide-card">
        <template #header>
          <div class="guide-header">
            <el-icon><InfoFilled /></el-icon>
            <span>LLM æ·±åº¦é›†æˆè½¬ä¼šå¸‚åœºç³»ç»Ÿè¯´æ˜</span>
          </div>
        </template>
        <div class="guide-content">
          <el-row :gutter="24">
            <el-col :span="12">
              <h4>ç³»ç»Ÿç‰¹ç‚¹</h4>
              <ul>
                <li><strong>AI Agent åŒ–</strong>ï¼šæ¯ä¸ªé€‰æ‰‹å’Œçƒé˜Ÿéƒ½æ˜¯ç‹¬ç«‹çš„ AI å†³ç­–å•å…ƒ</li>
                <li><strong>å¤šè½®åšå¼ˆ</strong>ï¼šæ¨¡æ‹ŸçœŸå®è°ˆåˆ¤ï¼ˆæŠ¥ä»· â†’ åé¦ˆ â†’ è°ƒæ•´ â†’ æˆäº¤ï¼‰</li>
                <li><strong>è¿é”ååº”</strong>ï¼šä¸€ç¬”ç­¾çº¦ä¼šå½±å“æ•´ä¸ªå¸‚åœºæ ¼å±€</li>
                <li><strong>æ€è·¯å¯è§</strong>ï¼šå®Œæ•´å±•ç¤º AI çš„åˆ†ææ­¥éª¤å’Œå†³ç­–è¿‡ç¨‹</li>
                <li><strong>æ•°æ®é©±åŠ¨</strong>ï¼šåŸºäºèµ›å­£è¡¨ç°ã€è£èª‰ã€ç§¯åˆ†ç­‰çœŸå®æ•°æ®</li>
              </ul>

              <h4>ä½¿ç”¨æµç¨‹</h4>
              <ol>
                <li><strong>åˆå§‹åŒ–å¸‚åœº</strong> - å¤„ç†åˆåŒåˆ°æœŸå’Œé€€å½¹é€‰æ‰‹</li>
                <li><strong>ç”Ÿæˆé€‰æ‰‹æ„æ„¿</strong> - AI åˆ†ææ¯ä¸ªé€‰æ‰‹çš„ç¦»é˜Ÿå€¾å‘</li>
                <li><strong>ç”Ÿæˆçƒé˜Ÿç­–ç•¥</strong> - AI ä¸ºçƒé˜Ÿåˆ¶å®šå¼•æ´è®¡åˆ’</li>
                <li><strong>æ‰§è¡Œè½¬ä¼šè½®æ¬¡</strong> - å¤šè½®è°ˆåˆ¤ç›´åˆ°å¸‚åœºç¨³å®š</li>
              </ol>
            </el-col>
            <el-col :span="12">
              <h4>å¸‚åœºé˜¶æ®µè¯´æ˜</h4>
              <el-timeline>
                <el-timeline-item type="primary">
                  <strong>åˆå§‹åŒ–</strong> - å¤„ç†åˆåŒåˆ°æœŸã€é€€å½¹é€‰æ‰‹ï¼Œå»ºç«‹å¸‚åœºåˆå§‹çŠ¶æ€
                </el-timeline-item>
                <el-timeline-item type="primary">
                  <strong>æ„æ„¿ç”Ÿæˆ</strong> - LLM åˆ†æé€‰æ‰‹æ»¡æ„åº¦ã€å¿ è¯šåº¦ã€è¡¨ç°ç­‰ï¼Œå†³å®šç¦»é˜Ÿæ„æ„¿
                </el-timeline-item>
                <el-timeline-item type="primary">
                  <strong>ç­–ç•¥ç”Ÿæˆ</strong> - LLM ä¸ºçƒé˜Ÿåˆ†æé˜µå®¹éœ€æ±‚ï¼Œç”Ÿæˆå¼•æ´ç›®æ ‡
                </el-timeline-item>
                <el-timeline-item type="warning">
                  <strong>é¦–è½®æŠ¥ä»·</strong> - çƒé˜Ÿå‘ç›®æ ‡é€‰æ‰‹å‘å‡ºæŠ¥ä»·
                </el-timeline-item>
                <el-timeline-item type="warning">
                  <strong>è°ˆåˆ¤åšå¼ˆ</strong> - å¤šè½®è°ˆåˆ¤ï¼Œè°ƒæ•´æŠ¥ä»·ï¼Œé€‰æ‰‹åšå‡ºé€‰æ‹©
                </el-timeline-item>
                <el-timeline-item type="danger">
                  <strong>è½¬ä¼šè½®æ¬¡</strong> - å‘æœ‰åˆåŒçš„é€‰æ‰‹å‘èµ·æŒ–äººï¼Œéœ€æ”¯ä»˜è½¬ä¼šè´¹
                </el-timeline-item>
                <el-timeline-item type="success">
                  <strong>æ”¶å°¾å®Œæˆ</strong> - è¡¥å…¨é˜µå®¹ï¼Œå¤„ç†å‰©ä½™è‡ªç”±çƒå‘˜
                </el-timeline-item>
              </el-timeline>

              <el-alert type="info" :closable="false" show-icon>
                <template #title>
                  æç¤ºï¼šç‚¹å‡»ã€Œæ‰§è¡Œä¸‹ä¸€è½®ã€é€æ­¥æ¨è¿›ï¼Œæˆ–ã€Œå¿«è¿›å®Œæˆã€ä¸€é”®å®Œæˆæ‰€æœ‰è½®æ¬¡
                </template>
              </el-alert>
            </el-col>
          </el-row>
        </div>
      </el-card>
    </el-collapse-transition>

    <!-- é˜¶æ®µè¿›åº¦ -->
    <el-card class="phase-card">
      <div class="phase-header">
        <span class="phase-title">å¸‚åœºé˜¶æ®µ</span>
        <span class="phase-text">{{ currentPhaseDescription }}</span>
      </div>
      <el-steps :active="currentPhaseIndex" finish-status="success" simple>
        <el-step
          v-for="phase in phases"
          :key="phase.key"
          :title="phase.name"
        />
      </el-steps>
    </el-card>

    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <el-row :gutter="16" class="stats-row">
      <el-col :span="6">
        <el-card class="stat-card">
          <div class="stat-content">
            <div class="stat-icon blue">
              <el-icon :size="24"><User /></el-icon>
            </div>
            <div class="stat-info">
              <div class="stat-number">{{ marketState?.free_agents_count ?? 0 }}</div>
              <div class="stat-label">è‡ªç”±çƒå‘˜</div>
            </div>
          </div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card class="stat-card">
          <div class="stat-content">
            <div class="stat-icon orange">
              <el-icon :size="24"><Message /></el-icon>
            </div>
            <div class="stat-info">
              <div class="stat-number">{{ marketState?.active_negotiations_count ?? 0 }}</div>
              <div class="stat-label">è¿›è¡Œä¸­è°ˆåˆ¤</div>
            </div>
          </div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card class="stat-card">
          <div class="stat-content">
            <div class="stat-icon green">
              <el-icon :size="24"><CircleCheck /></el-icon>
            </div>
            <div class="stat-info">
              <div class="stat-number">{{ marketState?.completed_transfers_count ?? 0 }}</div>
              <div class="stat-label">å·²å®Œæˆè½¬ä¼š</div>
            </div>
          </div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card class="stat-card">
          <div class="stat-content">
            <div class="stat-icon purple">
              <el-icon :size="24"><TrendCharts /></el-icon>
            </div>
            <div class="stat-info">
              <div class="stat-number">{{ marketState?.progress_percentage ?? 0 }}%</div>
              <div class="stat-label">æ•´ä½“è¿›åº¦</div>
            </div>
          </div>
        </el-card>
      </el-col>
    </el-row>

    <!-- æ“ä½œæŒ‰é’® -->
    <div class="action-bar">
      <!-- è§„åˆ™å¼•æ“æ¨¡å¼åˆ‡æ¢ -->
      <div v-if="isMarketInitialized && !isMarketComplete" style="margin-bottom: 16px;">
        <el-alert type="info" :closable="false">
          <template #title>
            <div style="display: flex; align-items: center; justify-content: space-between;">
              <span>
                <el-icon><Setting /></el-icon>
                æ‰§è¡Œæ¨¡å¼
              </span>
              <el-switch
                v-model="useRuleEngine"
                active-text="è§„åˆ™å¼•æ“ï¼ˆå¿«é€Ÿï¼‰"
                inactive-text="LLMå¼•æ“ï¼ˆæ…¢ï¼‰"
                size="large"
                style="margin-left: 20px;"
              />
            </div>
          </template>
          <div v-if="useRuleEngine" style="margin-top: 8px;">
            âš¡ <strong>è§„åˆ™å¼•æ“æ¨¡å¼</strong>ï¼šå‚è€ƒNBA 2Kè®¾è®¡ï¼Œçº¯è§„åˆ™é©±åŠ¨ï¼Œæ¯è½®<500msï¼Œæ•ˆç‡æå‡360-600å€ï¼Œæ— Tokenæ¶ˆè€—
          </div>
          <div v-else style="margin-top: 8px;">
            ğŸ¤– <strong>LLMå¼•æ“æ¨¡å¼</strong>ï¼šAIé©±åŠ¨å†³ç­–ï¼Œæ¯è½®20-30åˆ†é’Ÿï¼Œæ¶ˆè€—Tokenï¼Œä½†æœ‰è¯¦ç»†æ€è€ƒè¿‡ç¨‹
          </div>
        </el-alert>
      </div>

      <template v-if="!isMarketInitialized">
        <el-button type="primary" size="large" :loading="isLoading" @click="handleInitMarket">
          <el-icon><Plus /></el-icon>
          åˆå§‹åŒ–è½¬ä¼šå¸‚åœº
        </el-button>
      </template>

      <template v-else-if="canGenerateIntentions">
        <el-button type="primary" size="large" :loading="isGeneratingIntentions" @click="handleGenerateIntentions">
          <el-icon><UserFilled /></el-icon>
          ç”Ÿæˆé€‰æ‰‹æ„æ„¿
        </el-button>
      </template>

      <template v-else-if="canGenerateStrategies">
        <el-button type="primary" size="large" :loading="isGeneratingStrategies" @click="handleGenerateStrategies">
          <el-icon><TrendCharts /></el-icon>
          ç”Ÿæˆçƒé˜Ÿç­–ç•¥
        </el-button>
      </template>

      <template v-else-if="canProcessRenewals">
        <el-button type="primary" size="large" :loading="isProcessingRenewals" @click="handleProcessRenewals">
          <el-icon><DocumentChecked /></el-icon>
          å¤„ç†ç»­çº¦
        </el-button>
      </template>

      <template v-else-if="canAdvancePhase">
        <el-button type="primary" size="large" :loading="isLoading" @click="handleAdvancePhase">
          <el-icon><ArrowRight /></el-icon>
          æ¨è¿›åˆ°ä¸‹ä¸€é˜¶æ®µ
        </el-button>
      </template>

      <template v-else-if="canExecuteRound">
        <el-button type="primary" size="large" :loading="isExecutingRound" @click="handleExecuteRound">
          <el-icon><CaretRight /></el-icon>
          {{ currentPhase === 'TRANSFER_ROUNDS'
            ? `æ‰§è¡ŒæŒ–äººè½®æ¬¡ (${marketState?.transfer_round ?? 0}/${marketState?.max_transfer_rounds ?? 3})`
            : `æ‰§è¡Œä¸‹ä¸€è½® (${marketState?.current_round ?? 0}/${marketState?.max_rounds ?? 8})`
          }}
        </el-button>
        <el-button type="warning" size="large" :loading="isExecutingRound" @click="handleFastForward">
          <el-icon><DArrowRight /></el-icon>
          å¿«è¿›å®Œæˆ
        </el-button>
      </template>

      <template v-else-if="isMarketComplete">
        <el-tag type="success" size="large" effect="dark">
          <el-icon><CircleCheck /></el-icon>
          è½¬ä¼šå·²å®Œæˆ
        </el-tag>
      </template>

      <el-button v-if="isMarketInitialized" @click="handleRefresh" :loading="isLoading">
        <el-icon><Refresh /></el-icon>
        åˆ·æ–°çŠ¶æ€
      </el-button>

      <el-button v-if="isMarketInitialized" type="danger" plain @click="handleResetMarket" :loading="isLoading">
        <el-icon><Delete /></el-icon>
        é‡ç½®å¸‚åœº
      </el-button>

      <el-button @click="router.push('/transfer')">
        <el-icon><Back /></el-icon>
        è¿”å›
      </el-button>
    </div>

    <!-- ç”Ÿæˆè¿›åº¦ -->
    <el-card v-if="generationProgress" class="progress-card">
      <div class="progress-header">
        <span class="progress-title">{{ progressTitle }}</span>
        <span class="progress-text">{{ generationProgress.current }} / {{ generationProgress.total }}</span>
      </div>
      <el-progress
        :percentage="generationProgress.percentage"
        :stroke-width="12"
        :status="generationProgress.is_completed ? 'success' : undefined"
      />
      <div v-if="generationProgress.current_item" class="progress-item">
        æ­£åœ¨å¤„ç†: {{ generationProgress.current_item }}
      </div>
    </el-card>

    <!-- æœ€è¿‘æ‰§è¡Œç»“æœ -->
    <el-card v-if="lastRoundResult" class="round-result-card">
      <div class="round-result-header">
        <div class="round-badge">ç¬¬ {{ lastRoundResult.round }} è½®</div>
        <div class="round-phase">{{ getPhaseDisplayName(lastRoundResult.phase) }}</div>
      </div>
      <div class="round-result-content">
        {{ lastRoundResult.summary }}
      </div>
      <div class="round-stats">
        <div class="round-stat">
          <span class="stat-value">{{ lastRoundResult.new_negotiations }}</span>
          <span class="stat-label">æ–°å¢è°ˆåˆ¤</span>
        </div>
        <div class="round-stat">
          <span class="stat-value">{{ lastRoundResult.completed_signings }}</span>
          <span class="stat-label">å®Œæˆç­¾çº¦</span>
        </div>
        <div v-if="lastRoundResult.phase_changed" class="round-stat phase-changed">
          <span class="stat-value">é˜¶æ®µåˆ‡æ¢</span>
          <span class="stat-label">â†’ {{ getPhaseDisplayName(lastRoundResult.new_phase) }}</span>
        </div>
      </div>
    </el-card>

    <!-- ç»­çº¦å¤„ç†ç»“æœ -->
    <el-card v-if="renewalResult" class="renewal-result-card">
      <div class="renewal-result-header">
        <div class="renewal-badge">ç»­çº¦å¤„ç†å®Œæˆ</div>
        <div class="renewal-stats-inline">
          <span class="stat-success">{{ renewalResult.successful_renewals }} äººç»­çº¦æˆåŠŸ</span>
          <span class="stat-separator">|</span>
          <span class="stat-warning">{{ renewalResult.team_rejections }} äººè¢«çƒé˜Ÿæ”¾å¼ƒ</span>
          <span class="stat-separator">|</span>
          <span class="stat-danger">{{ renewalResult.player_rejections }} äººæ‹’ç»ç»­çº¦</span>
        </div>
      </div>
      <div v-if="renewalResult.decisions && renewalResult.decisions.length > 0" class="renewal-decisions-list">
        <div
          v-for="decision in renewalResult.decisions.slice(0, 5)"
          :key="decision.player_id"
          class="renewal-decision-item"
          :class="{
            'success': decision.renewal_successful,
            'team-reject': !decision.renewal_successful && !decision.team_wants_renewal,
            'player-reject': !decision.renewal_successful && decision.team_wants_renewal && !decision.player_accepts,
          }"
        >
          <div class="decision-main">
            <span class="player-name">{{ decision.player_name }}</span>
            <span class="team-name">{{ decision.team_name }}</span>
          </div>
          <div class="decision-result">
            <el-tag v-if="decision.renewal_successful" type="success" size="small">
              ç»­çº¦æˆåŠŸ ({{ decision.final_salary }}ä¸‡/{{ decision.final_years }}å¹´)
            </el-tag>
            <el-tag v-else-if="!decision.team_wants_renewal" type="warning" size="small">
              çƒé˜Ÿæ”¾å¼ƒ
            </el-tag>
            <el-tag v-else type="danger" size="small">
              æ‹’ç»ç»­çº¦
            </el-tag>
          </div>
          <div class="decision-summary">{{ decision.summary }}</div>
        </div>
        <div v-if="renewalResult.decisions.length > 5" class="more-hint">
          è¿˜æœ‰ {{ renewalResult.decisions.length - 5 }} æ¡è®°å½•...
        </div>
      </div>
    </el-card>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ - Tabs -->
    <el-tabs v-model="activeTab" class="content-tabs">
      <!-- ç¦»é˜Ÿå€™é€‰äºº -->
      <el-tab-pane label="ç¦»é˜Ÿå€™é€‰äºº" name="departures">
        <div class="tab-toolbar">
          <el-button @click="loadDepartureCandidates" :loading="isLoading" size="small">
            <el-icon><Refresh /></el-icon>
            åˆ·æ–°
          </el-button>
          <span class="count-badge">å…± {{ departureCandidates.length }} äºº</span>
        </div>
        <el-empty v-if="departureCandidates.length === 0" description="æš‚æ— ç¦»é˜Ÿå€™é€‰äºº" />
        <div v-else class="departure-list">
          <div
            v-for="candidate in departureCandidates"
            :key="candidate.player_id"
            class="departure-card"
            :class="{ 'expanded': expandedPlayerId === candidate.player_id }"
            @click="handleTogglePlayerExpand(candidate.player_id)"
          >
            <div class="departure-card-main">
              <div class="player-avatar" :class="getPositionClass(candidate.position)">
                {{ candidate.position }}
              </div>
              <div class="player-info">
                <div class="player-name">{{ candidate.player_name }}</div>
                <div class="player-meta">
                  {{ candidate.team_name }} Â· {{ candidate.age }}å² Â· èƒ½åŠ› {{ candidate.ability }}
                </div>
              </div>
              <div class="departure-reason">
                <div class="departure-tags">
                  <el-tag type="danger" size="small">
                    <el-icon><Warning /></el-icon>
                    æƒ³ç¦»é˜Ÿ
                  </el-tag>
                  <el-tag type="info" size="small">
                    å†³ç­–ç½®ä¿¡åº¦ {{ candidate.decision_confidence }}%
                  </el-tag>
                </div>
                <div class="reason-text">{{ candidate.leave_reasoning }}</div>
              </div>
              <div class="expected-salary">
                <span class="salary-value">{{ formatSalary(candidate.expected_salary) }}</span>
                <span class="salary-label">æœŸæœ›è–ªèµ„</span>
              </div>
              <div class="expand-icon">
                <el-icon :class="{ 'rotate': expandedPlayerId === candidate.player_id }">
                  <ArrowDown />
                </el-icon>
              </div>
            </div>
            <!-- å±•å¼€çš„åˆ†æè¯¦æƒ… -->
            <el-collapse-transition>
              <div v-if="expandedPlayerId === candidate.player_id" class="analysis-detail">
                <div v-if="loadingStrategyId === candidate.player_id" class="loading-analysis">
                  <el-icon class="is-loading"><Loading /></el-icon>
                  åŠ è½½åˆ†ææ•°æ®...
                </div>
                <div v-else-if="currentPlayerStrategy" class="analysis-content-wrapper">
                  <!-- é¡¶éƒ¨ï¼šLLM/Mock æ ‡è¯† + ç¦»é˜Ÿç†ç”± -->
                  <div class="analysis-header">
                    <el-tag v-if="!currentPlayerStrategy.is_mock" type="success" effect="dark" class="source-badge llm">
                      ğŸ¤– LLM ç”Ÿæˆ
                    </el-tag>
                    <el-tag v-else type="info" effect="plain" class="source-badge mock">
                      ğŸ“‹ è§„åˆ™ç”Ÿæˆ
                    </el-tag>
                    <div v-if="currentPlayerStrategy.leave_reasoning" class="leave-reasoning-box">
                      <strong>ç¦»é˜Ÿåˆ†æï¼š</strong>{{ currentPlayerStrategy.leave_reasoning }}
                    </div>
                  </div>

                  <!-- ä¸»ä½“å†…å®¹åŒº -->
                  <el-row :gutter="16" class="analysis-content">
                    <!-- å·¦ä¾§ï¼šåˆåŒæœŸæœ› -->
                    <el-col :span="8">
                      <div class="analysis-card">
                        <div class="card-header">
                          <el-icon><Money /></el-icon>
                          <span>åˆåŒæœŸæœ›</span>
                        </div>
                        <div class="contract-expectations">
                          <div class="expectation-item">
                            <span class="label">æœŸæœ›è–ªèµ„</span>
                            <span class="value highlight">{{ formatSalary(currentPlayerStrategy.expected_salary) }}/å¹´</span>
                          </div>
                          <div class="expectation-item">
                            <span class="label">æœ€ä½æ¥å—</span>
                            <span class="value">{{ formatSalary(currentPlayerStrategy.expected_min_salary) }}/å¹´</span>
                          </div>
                          <div class="expectation-item">
                            <span class="label">æœŸæœ›å¹´é™</span>
                            <span class="value">{{ currentPlayerStrategy.expected_years }} å¹´</span>
                          </div>
                          <div class="expectation-item">
                            <span class="label">é¦–å‘è¦æ±‚</span>
                            <span class="value" :class="{ 'require-yes': currentPlayerStrategy.requires_starter }">
                              {{ currentPlayerStrategy.requires_starter ? 'æ˜¯' : 'å¦' }}
                            </span>
                          </div>
                        </div>
                      </div>
                    </el-col>

                    <!-- ä¸­é—´ï¼šåå¥½çƒé˜Ÿ -->
                    <el-col :span="8">
                      <div class="analysis-card">
                        <div class="card-header">
                          <el-icon><Star /></el-icon>
                          <span>åå¥½çƒé˜Ÿ ({{ currentPlayerStrategy.preferred_teams?.length || 0 }})</span>
                        </div>
                        <div v-if="currentPlayerStrategy.preferred_teams && currentPlayerStrategy.preferred_teams.length > 0" class="preferred-teams">
                          <div
                            v-for="(team, index) in currentPlayerStrategy.preferred_teams.slice(0, 5)"
                            :key="team.team_id"
                            class="preferred-team"
                          >
                            <span class="team-rank">#{{ index + 1 }}</span>
                            <span class="team-name">{{ team.team_name }}</span>
                            <el-tag size="small" type="warning">{{ team.attractiveness_score }}</el-tag>
                          </div>
                        </div>
                        <div v-else class="empty-state">æš‚æ— åå¥½çƒé˜Ÿ</div>
                      </div>
                    </el-col>

                    <!-- å³ä¾§ï¼šAI åˆ†ææ­¥éª¤ -->
                    <el-col :span="8">
                      <div class="analysis-card">
                        <div class="card-header">
                          <el-icon><DataAnalysis /></el-icon>
                          <span>å†³ç­–åˆ†æ</span>
                        </div>
                        <div v-if="currentPlayerStrategy.analysis_steps && currentPlayerStrategy.analysis_steps.length > 0" class="analysis-steps">
                          <div
                            v-for="(step, index) in currentPlayerStrategy.analysis_steps"
                            :key="index"
                            class="analysis-step"
                          >
                            <div class="step-header">
                              <span class="step-number">{{ index + 1 }}</span>
                              <span class="step-name">{{ step.step_name }}</span>
                            </div>
                            <div class="step-result">{{ step.result }}</div>
                          </div>
                        </div>
                        <div v-else class="empty-state">
                          è§„åˆ™ç”Ÿæˆï¼Œæ— è¯¦ç»†åˆ†æ
                        </div>
                      </div>
                    </el-col>
                  </el-row>
                </div>
              </div>
            </el-collapse-transition>
          </div>
        </div>
      </el-tab-pane>

      <!-- è°ˆåˆ¤åˆ—è¡¨ -->
      <el-tab-pane label="è¿›è¡Œä¸­è°ˆåˆ¤" name="negotiations">
        <div class="tab-toolbar">
          <el-button @click="loadNegotiations" :loading="isLoading" size="small">
            <el-icon><Refresh /></el-icon>
            åˆ·æ–°
          </el-button>
          <span class="count-badge">å…± {{ negotiations.length }} ä¸ª</span>
        </div>
        <el-empty v-if="negotiations.length === 0" description="æš‚æ— è¿›è¡Œä¸­çš„è°ˆåˆ¤" />
        <el-table v-else :data="negotiations" stripe style="width: 100%">
          <el-table-column prop="player_name" label="é€‰æ‰‹" width="120">
            <template #default="{ row }">
              <div class="player-cell">
                <span class="position-tag" :class="getPositionClass(row.player_position)">
                  {{ row.player_position }}
                </span>
                <span class="name">{{ row.player_name }}</span>
              </div>
            </template>
          </el-table-column>
          <el-table-column prop="player_ability" label="èƒ½åŠ›" width="70" align="center">
            <template #default="{ row }">
              <span :class="getAbilityClass(row.player_ability)">{{ row.player_ability }}</span>
            </template>
          </el-table-column>
          <el-table-column prop="from_team_name" label="åŸçƒé˜Ÿ" width="120" />
          <el-table-column prop="status_name" label="çŠ¶æ€" width="80">
            <template #default="{ row }">
              <el-tag :type="getStatusTagType(row.status)" size="small">
                {{ row.status_name }}
              </el-tag>
            </template>
          </el-table-column>
          <el-table-column prop="offers_count" label="æŠ¥ä»·æ•°" width="80" align="center" />
          <el-table-column prop="competing_teams_count" label="ç«äº‰çƒé˜Ÿ" width="90" align="center" />
          <el-table-column prop="highest_offer" label="æœ€é«˜æŠ¥ä»·" width="100">
            <template #default="{ row }">
              {{ row.highest_offer ? formatSalary(row.highest_offer) : '-' }}
            </template>
          </el-table-column>
          <el-table-column prop="final_team_name" label="ç­¾çº¦çƒé˜Ÿ" width="120">
            <template #default="{ row }">
              <el-tag v-if="row.final_team_name" type="success" size="small">
                {{ row.final_team_name }}
              </el-tag>
              <span v-else class="text-muted">-</span>
            </template>
          </el-table-column>
          <el-table-column label="æ“ä½œ" width="100" fixed="right">
            <template #default="{ row }">
              <el-button size="small" text type="primary" @click="handleViewNegotiation(row.id)">
                è¯¦æƒ…
              </el-button>
            </template>
          </el-table-column>
        </el-table>
      </el-tab-pane>

      <!-- ç»­çº¦ç»“æœ -->
      <el-tab-pane label="ç»­çº¦ç»“æœ" name="renewals">
        <div class="tab-toolbar">
          <span class="count-badge">
            å…± {{ renewalResult?.decisions?.length ?? 0 }} æ¡ç»­çº¦è®°å½•
          </span>
          <template v-if="renewalResult">
            <el-tag type="success" size="small">{{ renewalResult.successful_renewals }} äººç»­çº¦æˆåŠŸ</el-tag>
            <el-tag type="warning" size="small">{{ renewalResult.team_rejections }} äººè¢«çƒé˜Ÿæ”¾å¼ƒ</el-tag>
            <el-tag type="danger" size="small">{{ renewalResult.player_rejections }} äººæ‹’ç»ç»­çº¦</el-tag>
          </template>
        </div>
        <el-empty v-if="!renewalResult || renewalResult.decisions.length === 0" description="æš‚æ— ç»­çº¦è®°å½•" />
        <div v-else class="renewals-list">
          <div
            v-for="decision in renewalResult.decisions"
            :key="decision.player_id"
            class="renewal-card"
            :class="{
              'success': decision.renewal_successful,
              'team-reject': !decision.renewal_successful && !decision.team_wants_renewal,
              'player-reject': !decision.renewal_successful && decision.team_wants_renewal && !decision.player_accepts,
              'expanded': expandedRenewalId === decision.player_id,
            }"
            @click="handleToggleRenewalExpand(decision.player_id)"
          >
            <!-- å¡ç‰‡ä¸»ä½“ -->
            <div class="renewal-card-main">
              <div class="renewal-status-icon">
                <el-icon v-if="decision.renewal_successful" color="#67c23a"><CircleCheck /></el-icon>
                <el-icon v-else-if="!decision.team_wants_renewal" color="#e6a23c"><RemoveFilled /></el-icon>
                <el-icon v-else color="#f56c6c"><CloseBold /></el-icon>
              </div>
              <div class="renewal-player-info">
                <div class="renewal-player-name">
                  <el-icon class="name-icon player"><User /></el-icon>
                  {{ decision.player_name }}
                </div>
                <div class="renewal-team-name">
                  <el-icon class="name-icon team"><OfficeBuilding /></el-icon>
                  {{ decision.team_name }}
                </div>
              </div>
              <div class="renewal-result-tag">
                <el-tag v-if="decision.renewal_successful" type="success" effect="dark">
                  ç»­çº¦æˆåŠŸ
                </el-tag>
                <el-tag v-else-if="!decision.team_wants_renewal" type="warning" effect="dark">
                  çƒé˜Ÿæ”¾å¼ƒ
                </el-tag>
                <el-tag v-else type="danger" effect="dark">
                  é€‰æ‰‹æ‹’ç»
                </el-tag>
              </div>
              <div v-if="decision.renewal_successful" class="renewal-contract">
                <span class="contract-value">{{ formatSalary(decision.final_salary ?? 0) }}/å¹´</span>
                <span class="contract-years">{{ decision.final_years }}å¹´</span>
              </div>
              <div v-else class="renewal-offer">
                <span class="offer-label">æŠ¥ä»·:</span>
                <span class="offer-value">{{ formatSalary(decision.offered_salary) }}/å¹´ Â· {{ decision.offered_years }}å¹´</span>
              </div>
              <div class="renewal-expand-icon">
                <el-icon :class="{ 'rotate': expandedRenewalId === decision.player_id }">
                  <ArrowDown />
                </el-icon>
              </div>
            </div>
            <!-- å±•å¼€çš„è¯¦æƒ…åŒºåŸŸ -->
            <el-collapse-transition>
              <div v-if="expandedRenewalId === decision.player_id" class="renewal-detail">
                <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
                <div class="detail-header">
                  <!-- åˆåŒä¿¡æ¯ -->
                  <div class="contract-info-card">
                    <div class="info-title">
                      <el-icon><DocumentChecked /></el-icon>
                      {{ decision.renewal_successful ? 'æ–°åˆåŒ' : 'æŠ¥ä»·æ¡ä»¶' }}
                    </div>
                    <div class="info-content">
                      <div class="info-item">
                        <span class="label">è–ªèµ„</span>
                        <span class="value salary">{{ formatSalary(decision.renewal_successful ? (decision.final_salary ?? 0) : decision.offered_salary) }}/å¹´</span>
                      </div>
                      <div class="info-item">
                        <span class="label">å¹´é™</span>
                        <span class="value">{{ decision.renewal_successful ? decision.final_years : decision.offered_years }}å¹´</span>
                      </div>
                    </div>
                  </div>

                  <!-- ç»“æœçŠ¶æ€ -->
                  <div class="result-status-card" :class="{
                    'success': decision.renewal_successful,
                    'team-reject': !decision.renewal_successful && !decision.team_wants_renewal,
                    'player-reject': !decision.renewal_successful && decision.team_wants_renewal
                  }">
                    <div class="status-icon">
                      <el-icon v-if="decision.renewal_successful"><CircleCheck /></el-icon>
                      <el-icon v-else-if="!decision.team_wants_renewal"><RemoveFilled /></el-icon>
                      <el-icon v-else><CloseBold /></el-icon>
                    </div>
                    <div class="status-text">
                      <template v-if="decision.renewal_successful">ç»­çº¦æˆåŠŸ</template>
                      <template v-else-if="!decision.team_wants_renewal">çƒé˜Ÿæ”¾å¼ƒ</template>
                      <template v-else>é€‰æ‰‹æ‹’ç»</template>
                    </div>
                  </div>
                </div>

                <!-- æ‘˜è¦ -->
                <div class="summary-card">
                  <div class="summary-icon">
                    <el-icon><ChatDotRound /></el-icon>
                  </div>
                  <div class="summary-text">{{ decision.summary }}</div>
                </div>

                <!-- æ‹’ç»åŸå› ï¼ˆå¦‚æœæœ‰ï¼‰ -->
                <div v-if="!decision.renewal_successful" class="rejection-card" :class="{
                  'team-reject': !decision.team_wants_renewal,
                  'player-reject': decision.team_wants_renewal
                }">
                  <div class="rejection-header">
                    <el-icon><Warning /></el-icon>
                    <span v-if="!decision.team_wants_renewal">çƒé˜Ÿæ”¾å¼ƒåŸå› </span>
                    <span v-else>é€‰æ‰‹æ‹’ç»åŸå› </span>
                  </div>
                  <div class="rejection-content">
                    {{ !decision.team_wants_renewal ? decision.team_rejection_reason : decision.player_rejection_reason }}
                  </div>
                </div>

                <!-- AI åˆ†æè¿‡ç¨‹ -->
                <div class="analysis-section">
                  <div class="section-title">
                    <el-icon><DataAnalysis /></el-icon>
                    AI åˆ†æè¿‡ç¨‹
                  </div>
                  <div class="analysis-grid">
                    <!-- çƒé˜Ÿè§†è§’ -->
                    <div class="analysis-card team-side">
                      <div class="card-header">
                        <el-icon><OfficeBuilding /></el-icon>
                        <span>çƒé˜Ÿè§†è§’</span>
                        <el-tag size="small" :type="decision.team_wants_renewal ? 'success' : 'danger'">
                          {{ decision.team_wants_renewal ? 'æ„¿æ„ç»­çº¦' : 'æ”¾å¼ƒç»­çº¦' }}
                        </el-tag>
                      </div>
                      <div v-if="decision.team_analysis && decision.team_analysis.length > 0" class="steps-container">
                        <div v-for="(step, idx) in decision.team_analysis" :key="'t-'+idx" class="step-item">
                          <div class="step-num">{{ idx + 1 }}</div>
                          <div class="step-content">
                            <div class="step-title">{{ step.step_name }}</div>
                            <div v-if="step.data_used" class="step-data">{{ step.data_used }}</div>
                            <div class="step-result">{{ step.result }}</div>
                            <el-tag v-if="step.impact" :type="getImpactTagType(step.impact)" size="small" class="step-tag">
                              {{ step.impact }}
                            </el-tag>
                          </div>
                        </div>
                      </div>
                      <div v-else class="no-data">æš‚æ— åˆ†ææ•°æ®</div>
                    </div>

                    <!-- é€‰æ‰‹è§†è§’ -->
                    <div class="analysis-card player-side">
                      <div class="card-header">
                        <el-icon><User /></el-icon>
                        <span>é€‰æ‰‹è§†è§’</span>
                        <el-tag size="small" :type="decision.player_accepts ? 'success' : 'danger'">
                          {{ decision.player_accepts ? 'æ¥å—ç»­çº¦' : 'æ‹’ç»ç»­çº¦' }}
                        </el-tag>
                      </div>
                      <div v-if="decision.player_analysis && decision.player_analysis.length > 0" class="steps-container">
                        <div v-for="(step, idx) in decision.player_analysis" :key="'p-'+idx" class="step-item">
                          <div class="step-num">{{ idx + 1 }}</div>
                          <div class="step-content">
                            <div class="step-title">{{ step.step_name }}</div>
                            <div v-if="step.data_used" class="step-data">{{ step.data_used }}</div>
                            <div class="step-result">{{ step.result }}</div>
                            <el-tag v-if="step.impact" :type="getImpactTagType(step.impact)" size="small" class="step-tag">
                              {{ step.impact }}
                            </el-tag>
                          </div>
                        </div>
                      </div>
                      <div v-else class="no-data">æš‚æ— åˆ†ææ•°æ®</div>
                    </div>
                  </div>
                </div>
              </div>
            </el-collapse-transition>
          </div>
        </div>
      </el-tab-pane>

      <!-- å¸‚åœºäº‹ä»¶ -->
      <el-tab-pane label="å¸‚åœºåŠ¨æ€" name="events">
        <div class="tab-toolbar">
          <el-button @click="loadEvents" :loading="isLoading" size="small">
            <el-icon><Refresh /></el-icon>
            åˆ·æ–°
          </el-button>
          <el-radio-group v-model="eventFilter" size="small">
            <el-radio-button value="all">å…¨éƒ¨</el-radio-button>
            <el-radio-button value="signing">ç­¾çº¦</el-radio-button>
            <el-radio-button value="thinking">æ€è€ƒè¿‡ç¨‹</el-radio-button>
            <el-radio-button value="transfer">è½¬ä¼šè¯·æ±‚</el-radio-button>
          </el-radio-group>
          <span class="count-badge">å…± {{ filteredEvents.length }} æ¡</span>
        </div>
        <el-empty v-if="filteredEvents.length === 0" description="æš‚æ— å¸‚åœºåŠ¨æ€" />
        <div v-else class="events-list">
          <div
            v-for="event in filteredEvents"
            :key="event.id"
            class="event-card"
            :class="[getEventClass(event.event_type), { 'clickable': isThinkingEvent(event.event_type) }]"
            @click="handleEventClick(event)"
          >
            <div class="event-icon" :class="getEventClass(event.event_type)">
              <el-icon v-if="event.event_type === 'SIGNING_COMPLETED'"><CircleCheck /></el-icon>
              <el-icon v-else-if="event.event_type === 'TRANSFER_REQUESTED'"><Message /></el-icon>
              <el-icon v-else-if="event.event_type === 'OFFER_ACCEPTED'"><Check /></el-icon>
              <el-icon v-else-if="event.event_type === 'OFFER_REJECTED'"><Close /></el-icon>
              <el-icon v-else-if="event.event_type === 'TEAM_THINKING'"><Cpu /></el-icon>
              <el-icon v-else-if="event.event_type === 'PLAYER_THINKING'"><User /></el-icon>
              <el-icon v-else-if="event.event_type === 'OFFER_MADE'"><Position /></el-icon>
              <el-icon v-else><Bell /></el-icon>
            </div>
            <div class="event-content">
              <div class="event-title">
                {{ event.title }}
                <el-tag v-if="isThinkingEvent(event.event_type)" type="info" size="small" class="thinking-tag">
                  ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…
                </el-tag>
              </div>
              <div class="event-desc" :class="{ 'truncated': isThinkingEvent(event.event_type) }">
                {{ isThinkingEvent(event.event_type) ? truncateText(event.description, 100) : event.description }}
              </div>
              <div class="event-meta">
                <span class="event-round">ç¬¬{{ event.round }}è½®</span>
                <span class="event-phase">{{ getPhaseDisplayName(event.phase) }}</span>
                <span v-if="event.player_name" class="event-player">{{ event.player_name }}</span>
                <span v-if="event.team_name" class="event-team">{{ event.team_name }}</span>
              </div>
            </div>
          </div>
        </div>
      </el-tab-pane>

      <!-- çƒé˜ŸçŠ¶æ€ -->
      <el-tab-pane label="çƒé˜ŸçŠ¶æ€" name="teams">
        <div class="tab-toolbar">
          <el-button @click="loadTeamStates" :loading="isLoading" size="small">
            <el-icon><Refresh /></el-icon>
            åˆ·æ–°
          </el-button>
          <span class="count-badge">å…± {{ teamStates.length }} æ”¯çƒé˜Ÿ</span>
        </div>
        <el-empty v-if="teamStates.length === 0" description="æš‚æ— çƒé˜Ÿæ•°æ®" />
        <el-table v-else :data="teamStates" stripe style="width: 100%">
          <el-table-column prop="team_name" label="çƒé˜Ÿ" width="150" />
          <el-table-column prop="remaining_budget" label="å‰©ä½™é¢„ç®—" width="120">
            <template #default="{ row }">
              {{ formatSalary(row.remaining_budget) }}
            </template>
          </el-table-column>
          <el-table-column prop="spent_amount" label="å·²èŠ±è´¹" width="120">
            <template #default="{ row }">
              {{ formatSalary(row.spent_amount) }}
            </template>
          </el-table-column>
          <el-table-column prop="roster_count" label="é˜µå®¹äººæ•°" width="100" align="center">
            <template #default="{ row }">
              <span :class="{ 'roster-warning': row.roster_count < row.min_roster_size }">
                {{ row.roster_count }}/{{ row.min_roster_size }}
              </span>
            </template>
          </el-table-column>
          <el-table-column prop="pending_negotiations" label="å¾…å®šè°ˆåˆ¤" width="100" align="center" />
          <el-table-column prop="completed_signings" label="å·²ç­¾çº¦" width="90" align="center" />
          <el-table-column prop="departed_players" label="å·²ç¦»é˜Ÿ" width="90" align="center" />
          <el-table-column prop="strategy_generated" label="ç­–ç•¥" width="80" align="center">
            <template #default="{ row }">
              <el-icon v-if="row.strategy_generated" color="#67c23a"><CircleCheck /></el-icon>
              <el-icon v-else color="#909399"><Clock /></el-icon>
            </template>
          </el-table-column>
          <el-table-column prop="needs_emergency_signing" label="ç´§æ€¥è¡¥å‘˜" width="100" align="center">
            <template #default="{ row }">
              <el-tag v-if="row.needs_emergency_signing" type="danger" size="small">éœ€è¦</el-tag>
              <span v-else class="text-muted">-</span>
            </template>
          </el-table-column>
          <el-table-column label="æ“ä½œ" width="100" fixed="right">
            <template #default="{ row }">
              <el-button
                size="small"
                text
                type="primary"
                :disabled="!row.strategy_generated"
                @click="handleViewTeamStrategy(row.team_id)"
              >
                æŸ¥çœ‹ç­–ç•¥
              </el-button>
            </template>
          </el-table-column>
        </el-table>
      </el-tab-pane>

      <!-- çƒé˜Ÿç­–ç•¥ -->
      <el-tab-pane label="çƒé˜Ÿç­–ç•¥" name="strategies">
        <div class="tab-toolbar">
          <span class="count-badge">å·²ç”Ÿæˆ {{ generatedStrategiesCount }} æ”¯çƒé˜Ÿç­–ç•¥</span>
        </div>
        <el-empty v-if="!currentTeamStrategy" description="ç‚¹å‡»çƒé˜ŸçŠ¶æ€ Tab ä¸­çš„ã€ŒæŸ¥çœ‹ç­–ç•¥ã€æŒ‰é’®æ¥æŸ¥çœ‹è¯¦æƒ…" />
        <div v-else class="team-strategy-detail">
          <div class="strategy-header">
            <div class="team-info">
              <h3>{{ currentTeamStrategy.team_name || `çƒé˜Ÿ #${currentTeamStrategy.team_id}` }}</h3>
              <el-tag :type="getStrategyTagType(currentTeamStrategy.overall_strategy)" size="large">
                {{ currentTeamStrategy.overall_strategy }}
              </el-tag>
              <!-- LLM/Mock æ ‡è¯† -->
              <el-tag v-if="!currentTeamStrategy.is_mock" type="success" effect="dark" class="source-badge llm">
                ğŸ¤– LLM ç”Ÿæˆ
              </el-tag>
              <el-tag v-else type="info" effect="plain" class="source-badge mock">
                ğŸ“‹ è§„åˆ™ç”Ÿæˆ
              </el-tag>
            </div>
            <div class="strategy-description">
              {{ currentTeamStrategy.strategy_description }}
            </div>
          </div>

          <el-row :gutter="20" class="strategy-content">
            <!-- å¼•æ´ç›®æ ‡ -->
            <el-col :span="12">
              <div class="strategy-section">
                <h4>
                  <el-icon><Plus /></el-icon>
                  å¼•æ´ç›®æ ‡ ({{ currentTeamStrategy.targets?.length || 0 }})
                </h4>
                <div v-if="currentTeamStrategy.targets && currentTeamStrategy.targets.length > 0" class="targets-list">
                  <div
                    v-for="target in currentTeamStrategy.targets"
                    :key="target.player_id"
                    class="target-item"
                  >
                    <div class="target-main">
                      <span class="position-tag" :class="getPositionClass(target.position)">
                        {{ target.position }}
                      </span>
                      <span class="player-name">{{ target.player_name }}</span>
                      <span class="ability">èƒ½åŠ› {{ target.ability }}</span>
                    </div>
                    <div class="target-details">
                      <el-tag type="warning" size="small">ä¼˜å…ˆåº¦ {{ target.priority }}</el-tag>
                      <span class="budget">é¢„ç®— {{ formatSalary(target.max_offer) }}</span>
                    </div>
                    <div v-if="target.reasoning" class="target-reasoning">
                      {{ target.reasoning }}
                    </div>
                  </div>
                </div>
                <div v-else class="empty-list">æš‚æ— å¼•æ´ç›®æ ‡</div>
              </div>
            </el-col>

            <!-- å‡ºå”®åå• -->
            <el-col :span="12">
              <div class="strategy-section">
                <h4>
                  <el-icon><Minus /></el-icon>
                  å‡ºå”®åå• ({{ currentTeamStrategy.willing_to_sell?.length || 0 }})
                </h4>
                <div v-if="currentTeamStrategy.willing_to_sell && currentTeamStrategy.willing_to_sell.length > 0" class="sell-list">
                  <div
                    v-for="player in currentTeamStrategy.willing_to_sell"
                    :key="player.player_id"
                    class="sell-item"
                  >
                    <div class="sell-main">
                      <span class="position-tag" :class="getPositionClass(player.position)">
                        {{ player.position }}
                      </span>
                      <span class="player-name">{{ player.player_name }}</span>
                      <span class="ability">èƒ½åŠ› {{ player.ability }}</span>
                    </div>
                    <div class="sell-details">
                      <span class="price">åº•ä»· {{ formatSalary(player.min_price) }}</span>
                      <el-tag size="small">ç´§è¿«åº¦ {{ player.urgency }}</el-tag>
                    </div>
                    <div v-if="player.reasoning" class="sell-reasoning">
                      {{ player.reasoning }}
                    </div>
                  </div>
                </div>
                <div v-else class="empty-list">æš‚æ— å‡ºå”®è®¡åˆ’</div>
              </div>
            </el-col>
          </el-row>

          <!-- é¢„ç®—åˆ†é… -->
          <div class="budget-section">
            <h4>
              <el-icon><Money /></el-icon>
              é¢„ç®—åˆ†é…
            </h4>
            <div class="budget-grid">
              <div class="budget-item">
                <span class="label">æ€»é¢„ç®—</span>
                <span class="value">{{ formatSalary(currentTeamStrategy.budget_allocation?.total_budget || 0) }}</span>
              </div>
              <div class="budget-item">
                <span class="label">è½¬ä¼šè´¹é¢„ç®—</span>
                <span class="value">{{ formatSalary(currentTeamStrategy.budget_allocation?.transfer_spend || 0) }}</span>
              </div>
              <div class="budget-item">
                <span class="label">è–ªèµ„é¢„ç®—</span>
                <span class="value">{{ formatSalary(currentTeamStrategy.budget_allocation?.salary_spend || 0) }}</span>
              </div>
              <div class="budget-item">
                <span class="label">å‚¨å¤‡é‡‘</span>
                <span class="value">{{ formatSalary(currentTeamStrategy.budget_allocation?.reserve || 0) }}</span>
              </div>
            </div>
          </div>

          <!-- AI åˆ†ææ­¥éª¤ -->
          <div v-if="currentTeamStrategy.analysis_steps && currentTeamStrategy.analysis_steps.length > 0" class="analysis-section team-analysis">
            <h4>
              <el-icon><DataAnalysis /></el-icon>
              AI åˆ†æè¿‡ç¨‹
            </h4>
            <div class="analysis-steps">
              <div
                v-for="(step, index) in currentTeamStrategy.analysis_steps"
                :key="index"
                class="analysis-step"
              >
                <div class="step-header">
                  <span class="step-number">{{ index + 1 }}</span>
                  <span class="step-name">{{ step.step_name }}</span>
                  <el-tag :type="getStepImpactType(step.impact)" size="small">
                    {{ step.impact }}
                  </el-tag>
                </div>
                <div class="step-detail">
                  <div v-if="step.data_used" class="step-row">
                    <span class="step-label">æ•°æ®:</span>
                    <span class="step-value">{{ step.data_used }}</span>
                  </div>
                  <div v-if="step.threshold" class="step-row">
                    <span class="step-label">é˜ˆå€¼:</span>
                    <span class="step-value">{{ step.threshold }}</span>
                  </div>
                  <div class="step-row">
                    <span class="step-label">ç»“è®º:</span>
                    <span class="step-value result">{{ step.result }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ç­–ç•¥åŸå›  -->
          <div v-if="currentTeamStrategy.reasoning" class="reasoning-section">
            <h4>
              <el-icon><ChatDotRound /></el-icon>
              ç­–ç•¥è¯´æ˜
            </h4>
            <div class="reasoning-text">
              {{ currentTeamStrategy.reasoning }}
            </div>
          </div>
        </div>
      </el-tab-pane>
    </el-tabs>

    <!-- è°ˆåˆ¤è¯¦æƒ…å¼¹çª— -->
    <el-dialog
      v-model="showNegotiationDialog"
      title="è°ˆåˆ¤è¯¦æƒ…"
      width="800px"
      destroy-on-close
    >
      <div v-if="currentNegotiation" class="negotiation-detail">
        <!-- é€‰æ‰‹ä¿¡æ¯ -->
        <div class="detail-header">
          <div class="player-avatar large" :class="getPositionClass(currentNegotiation.negotiation.player_position)">
            {{ currentNegotiation.negotiation.player_position }}
          </div>
          <div class="player-info">
            <div class="player-name large">{{ currentNegotiation.negotiation.player_name }}</div>
            <div class="player-meta">
              èƒ½åŠ› {{ currentNegotiation.negotiation.player_ability }} Â·
              {{ currentNegotiation.negotiation.from_team_name || 'è‡ªç”±çƒå‘˜' }}
            </div>
          </div>
          <el-tag :type="getStatusTagType(currentNegotiation.negotiation.status)" size="large">
            {{ currentNegotiation.negotiation.status }}
          </el-tag>
        </div>

        <!-- æŠ¥ä»·åˆ—è¡¨ -->
        <div class="offers-section">
          <h4>æŠ¥ä»·å†å²</h4>
          <div
            v-for="teamHistory in currentNegotiation.offers_by_team"
            :key="teamHistory.team_id"
            class="team-offer-history"
          >
            <div class="team-header">
              <span class="team-name">{{ teamHistory.team_name }}</span>
              <el-tag v-if="teamHistory.is_leading" type="success" size="small">é¢†å…ˆ</el-tag>
            </div>
            <div
              v-for="offer in teamHistory.offers"
              :key="offer.id"
              class="offer-item"
            >
              <div class="offer-round">ç¬¬{{ offer.round }}è½®</div>
              <div class="offer-content">
                <span class="salary">{{ formatSalary(offer.salary_offer) }}/å¹´</span>
                <span class="years">{{ offer.contract_years }}å¹´</span>
                <el-tag v-if="offer.guarantee_starter" type="warning" size="small">é¦–å‘ä¿è¯</el-tag>
              </div>
              <el-tag :type="getOfferStatusTagType(offer.status)" size="small">
                {{ offer.status }}
              </el-tag>
            </div>
          </div>
        </div>

        <!-- æ—¶é—´çº¿ -->
        <div class="timeline-section">
          <h4>è°ˆåˆ¤æ—¶é—´çº¿</h4>
          <el-timeline>
            <el-timeline-item
              v-for="event in currentNegotiation.timeline"
              :key="event.timestamp"
              :type="getTimelineItemType(event.event_type)"
            >
              <div class="timeline-content">
                <div class="timeline-title">{{ event.description }}</div>
                <div v-if="event.details" class="timeline-details">{{ event.details }}</div>
              </div>
            </el-timeline-item>
          </el-timeline>
        </div>
      </div>
    </el-dialog>

    <!-- æ€è€ƒè¿‡ç¨‹è¯¦æƒ…å¼¹çª— -->
    <el-dialog
      v-model="thinkingDialogVisible"
      :title="thinkingDialogTitle"
      width="700px"
      class="thinking-dialog"
    >
      <div v-if="selectedThinkingEvent" class="thinking-content">
        <div class="thinking-header">
          <el-tag v-if="selectedThinkingEvent.event_type === 'TEAM_THINKING'" type="primary" effect="dark">
            ğŸ¢ æˆ˜é˜Ÿåˆ†æ
          </el-tag>
          <el-tag v-else type="success" effect="dark">
            ğŸ® é€‰æ‰‹è€ƒè™‘
          </el-tag>
          <span class="thinking-round">ç¬¬ {{ selectedThinkingEvent.round }} è½®</span>
        </div>

        <div class="thinking-info">
          <div v-if="selectedThinkingEvent.player_name" class="info-item">
            <span class="label">é€‰æ‰‹:</span>
            <span class="value">{{ selectedThinkingEvent.player_name }}</span>
          </div>
          <div v-if="selectedThinkingEvent.team_name" class="info-item">
            <span class="label">æˆ˜é˜Ÿ:</span>
            <span class="value">{{ selectedThinkingEvent.team_name }}</span>
          </div>
        </div>

        <div class="thinking-body" :class="{
          'team-thinking': selectedThinkingEvent.event_type === 'TEAM_THINKING',
          'player-thinking': selectedThinkingEvent.event_type === 'PLAYER_THINKING'
        }">
          <div class="thinking-title">ğŸ’­ æ€è€ƒè¿‡ç¨‹</div>
          <pre class="thinking-text">{{ selectedThinkingEvent.description }}</pre>
        </div>
      </div>
    </el-dialog>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { storeToRefs } from 'pinia'
import { ElMessage, ElMessageBox } from 'element-plus'
import {
  User, Message, CircleCheck, TrendCharts, Plus, UserFilled,
  CaretRight, DArrowRight, Refresh, Back, Bell, Check, Close, Clock,
  QuestionFilled, InfoFilled, ArrowDown, ArrowRight, Warning, Loading, DataAnalysis,
  Star, Money, Minus, ChatDotRound, Delete, DocumentChecked, RemoveFilled, CloseBold, OfficeBuilding,
  Cpu, Position, Setting,
} from '@element-plus/icons-vue'
import { useLLMMarketStore, PHASE_NAMES } from '@/stores/useLLMMarketStore'
import { useGameStore } from '@/stores/useGameStore'
import { llmMarketApi } from '@/api/tauri'
import type { RoundExecutionResult, MarketPhase, PlayerTransferStrategy, AITransferStrategy } from '@/api/tauri'

const router = useRouter()
const llmMarketStore = useLLMMarketStore()
const gameStore = useGameStore()

// Store çŠ¶æ€
const {
  marketState,
  teamStates,
  negotiations,
  currentNegotiation,
  departureCandidates,
  events,
  isLoading,
  isGeneratingIntentions,
  isGeneratingStrategies,
  isProcessingRenewals,
  isExecutingRound,
  useRuleEngine,  // è§„åˆ™å¼•æ“æ¨¡å¼å¼€å…³
  generationProgress,
  renewalResult,
  // error is available but not currently used
  isMarketInitialized,
  currentPhase,
  currentPhaseName,
  currentPhaseDescription,
  canGenerateIntentions,
  canGenerateStrategies,
  canProcessRenewals,
  canExecuteRound,
  canAdvancePhase,
  isMarketComplete,
} = storeToRefs(llmMarketStore)

const { currentSeason } = storeToRefs(gameStore)

// æœ¬åœ°çŠ¶æ€
const activeTab = ref('departures')
const eventFilter = ref('all')
const lastRoundResult = ref<RoundExecutionResult | null>(null)
const showNegotiationDialog = ref(false)
const showGuide = ref(true)  // é»˜è®¤æ˜¾ç¤ºä½¿ç”¨è¯´æ˜

// é€‰æ‰‹ç­–ç•¥å±•å¼€çŠ¶æ€
const expandedPlayerId = ref<number | null>(null)
const loadingStrategyId = ref<number | null>(null)
const currentPlayerStrategy = ref<PlayerTransferStrategy | null>(null)

// çƒé˜Ÿç­–ç•¥çŠ¶æ€
const currentTeamStrategy = ref<AITransferStrategy | null>(null)

// ç»­çº¦è¯¦æƒ…å±•å¼€çŠ¶æ€
const expandedRenewalId = ref<number | null>(null)

// æ€è€ƒè¿‡ç¨‹å¼¹çª—çŠ¶æ€
const thinkingDialogVisible = ref(false)
const selectedThinkingEvent = ref<any>(null)

// æ€è€ƒå¼¹çª—æ ‡é¢˜
const thinkingDialogTitle = computed(() => {
  if (!selectedThinkingEvent.value) return 'æ€è€ƒè¿‡ç¨‹'
  const event = selectedThinkingEvent.value
  if (event.event_type === 'TEAM_THINKING') {
    return `ğŸ¢ ${event.team_name || 'æˆ˜é˜Ÿ'} çš„åˆ†æè¿‡ç¨‹`
  } else {
    return `ğŸ® ${event.player_name || 'é€‰æ‰‹'} çš„æ€è€ƒè¿‡ç¨‹`
  }
})

// é˜¶æ®µåˆ—è¡¨
const phases = [
  { key: 'INTENTION_GENERATION', name: 'é€‰æ‰‹æ„æ„¿' },
  { key: 'STRATEGY_GENERATION', name: 'æˆ˜é˜Ÿç­–ç•¥' },
  { key: 'RENEWAL_PROCESSING', name: 'ç»­çº¦å¤„ç†' },
  { key: 'FREE_MARKET', name: 'è‡ªç”±å¸‚åœº' },
  { key: 'TRANSFER_ROUNDS', name: 'æŒ–è§’è½¬ä¼š' },
  { key: 'COMPLETED', name: 'å®Œæˆ' },
]

// è®¡ç®—å±æ€§
const currentPhaseIndex = computed(() => {
  const index = phases.findIndex(p => p.key === currentPhase.value)
  return index >= 0 ? index : 0
})

const phaseTagType = computed(() => {
  if (isMarketComplete.value) return 'success'
  if (currentPhaseIndex.value >= 5) return 'warning'
  return 'primary'
})

const progressTitle = computed(() => {
  if (generationProgress.value?.task_type === 'player_intentions') {
    return 'ç”Ÿæˆé€‰æ‰‹æ„æ„¿'
  }
  if (generationProgress.value?.task_type === 'team_strategies') {
    return 'ç”Ÿæˆçƒé˜Ÿç­–ç•¥'
  }
  if (generationProgress.value?.task_type === 'renewals') {
    return 'å¤„ç†ç»­çº¦'
  }
  return 'å¤„ç†ä¸­'
})

const filteredEvents = computed(() => {
  let filtered = [...events.value]
  if (eventFilter.value === 'signing') {
    filtered = filtered.filter(e =>
      e.event_type === 'SIGNING_COMPLETED' ||
      e.event_type === 'OFFER_ACCEPTED'
    )
  } else if (eventFilter.value === 'transfer') {
    filtered = filtered.filter(e => e.event_type === 'TRANSFER_REQUESTED')
  } else if (eventFilter.value === 'thinking') {
    filtered = filtered.filter(e =>
      e.event_type === 'TEAM_THINKING' ||
      e.event_type === 'PLAYER_THINKING'
    )
  }
  return filtered.reverse()
})

// å·²ç”Ÿæˆç­–ç•¥çš„çƒé˜Ÿæ•°é‡
const generatedStrategiesCount = computed(() => {
  return teamStates.value.filter(ts => ts.strategy_generated).length
})

// åˆå§‹åŒ–
onMounted(async () => {
  try {
    await gameStore.refreshGameState()
    await llmMarketStore.loadMarketState()
    if (isMarketInitialized.value) {
      await loadDepartureCandidates()
      await loadNegotiations()
      await loadEvents()
      await loadTeamStates()
    }
  } catch (e) {
    // å¸‚åœºæœªåˆå§‹åŒ–æ˜¯æ­£å¸¸æƒ…å†µ
    console.log('Market not initialized yet')
  }
})

// æ“ä½œæ–¹æ³•
const handleInitMarket = async () => {
  try {
    await llmMarketStore.initMarket()
    ElMessage.success('è½¬ä¼šå¸‚åœºåˆå§‹åŒ–æˆåŠŸ')
  } catch (e) {
    ElMessage.error('åˆå§‹åŒ–å¤±è´¥: ' + (e as Error).message)
  }
}

const handleGenerateIntentions = async () => {
  try {
    await llmMarketStore.generateIntentions()
    await loadDepartureCandidates()
    ElMessage.success('é€‰æ‰‹æ„æ„¿ç”Ÿæˆå®Œæˆ')
  } catch (e) {
    ElMessage.error('ç”Ÿæˆå¤±è´¥: ' + (e as Error).message)
  }
}

const handleGenerateStrategies = async () => {
  try {
    await llmMarketStore.generateStrategies()
    await loadTeamStates()
    ElMessage.success('çƒé˜Ÿç­–ç•¥ç”Ÿæˆå®Œæˆ')
  } catch (e) {
    ElMessage.error('ç”Ÿæˆå¤±è´¥: ' + (e as Error).message)
  }
}

const handleProcessRenewals = async () => {
  try {
    const result = await llmMarketStore.processRenewals()
    if (result) {
      const msg = `ç»­çº¦å¤„ç†å®Œæˆï¼š${result.successful_renewals} äººç»­çº¦æˆåŠŸï¼Œ${result.team_rejections} äººè¢«çƒé˜Ÿæ”¾å¼ƒï¼Œ${result.player_rejections} äººæ‹’ç»ç»­çº¦`
      ElMessage.success(msg)
    }
    await loadDepartureCandidates()
    await loadEvents()
  } catch (e) {
    ElMessage.error('ç»­çº¦å¤„ç†å¤±è´¥: ' + (e as Error).message)
  }
}

const handleAdvancePhase = async () => {
  try {
    await llmMarketStore.advancePhase()
    await loadDepartureCandidates()
    await loadNegotiations()
    await loadEvents()
    await loadTeamStates()
    ElMessage.success(`å·²æ¨è¿›åˆ°: ${currentPhaseName.value}`)
  } catch (e) {
    ElMessage.error('æ¨è¿›é˜¶æ®µå¤±è´¥: ' + (e as Error).message)
  }
}

const handleExecuteRound = async () => {
  try {
    const result = await llmMarketStore.executeRound()
    if (result) {
      lastRoundResult.value = result
      await loadNegotiations()
      await loadEvents()
      ElMessage.success(`ç¬¬ ${result.round} è½®æ‰§è¡Œå®Œæˆ`)
    }
  } catch (e) {
    ElMessage.error('æ‰§è¡Œå¤±è´¥: ' + (e as Error).message)
  }
}

const handleFastForward = async () => {
  try {
    await ElMessageBox.confirm(
      'å°†å¿«é€Ÿå®Œæˆæ‰€æœ‰å‰©ä½™è½®æ¬¡ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ',
      'å¿«è¿›å®Œæˆ',
      { type: 'warning' }
    )

    while (canExecuteRound.value) {
      await llmMarketStore.executeRound()
    }

    await loadNegotiations()
    await loadEvents()
    await loadTeamStates()
    ElMessage.success('è½¬ä¼šå¸‚åœºå·²å®Œæˆ')
  } catch (e) {
    if (e !== 'cancel') {
      ElMessage.error('æ‰§è¡Œå¤±è´¥: ' + (e as Error).message)
    }
  }
}

const handleRefresh = async () => {
  try {
    await llmMarketStore.loadMarketState()
    await loadDepartureCandidates()
    await loadNegotiations()
    await loadEvents()
    await loadTeamStates()
  } catch (e) {
    ElMessage.error('åˆ·æ–°å¤±è´¥')
  }
}

const handleResetMarket = async () => {
  try {
    await ElMessageBox.confirm(
      'å°†æ¸…é™¤æ‰€æœ‰è½¬ä¼šå¸‚åœºæ•°æ®ï¼ˆé€‰æ‰‹æ„æ„¿ã€çƒé˜Ÿç­–ç•¥ã€è°ˆåˆ¤è®°å½•ï¼‰å¹¶é‡æ–°å¼€å§‹ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ',
      'é‡ç½®è½¬ä¼šå¸‚åœº',
      { type: 'warning', confirmButtonText: 'ç¡®è®¤é‡ç½®', cancelButtonText: 'å–æ¶ˆ' }
    )

    await llmMarketStore.resetMarket()
    // æ¸…ç†æœ¬åœ°çŠ¶æ€
    lastRoundResult.value = null
    expandedPlayerId.value = null
    currentPlayerStrategy.value = null
    currentTeamStrategy.value = null
    ElMessage.success('è½¬ä¼šå¸‚åœºå·²é‡ç½®ï¼Œå¯é‡æ–°åˆå§‹åŒ–')
  } catch (e) {
    if (e !== 'cancel') {
      ElMessage.error('é‡ç½®å¤±è´¥: ' + (e as Error).message)
    }
  }
}

const loadDepartureCandidates = async () => {
  await llmMarketStore.loadDepartureCandidates()
}

const loadNegotiations = async () => {
  await llmMarketStore.loadNegotiations()
}

const loadEvents = async () => {
  await llmMarketStore.loadEvents()
}

const loadTeamStates = async () => {
  await llmMarketStore.loadTeamStates()
}

const handleViewNegotiation = async (id: number) => {
  try {
    await llmMarketStore.loadNegotiationDetail(id)
    showNegotiationDialog.value = true
  } catch (e) {
    ElMessage.error('åŠ è½½è°ˆåˆ¤è¯¦æƒ…å¤±è´¥')
  }
}

// åˆ‡æ¢é€‰æ‰‹ç­–ç•¥å±•å¼€çŠ¶æ€
const handleTogglePlayerExpand = async (playerId: number) => {
  if (expandedPlayerId.value === playerId) {
    // æ”¶èµ·
    expandedPlayerId.value = null
    currentPlayerStrategy.value = null
  } else {
    // å±•å¼€å¹¶åŠ è½½æ•°æ®
    expandedPlayerId.value = playerId
    loadingStrategyId.value = playerId
    currentPlayerStrategy.value = null

    try {
      const strategy = await llmMarketApi.getPlayerStrategy(playerId)
      if (strategy) {
        currentPlayerStrategy.value = strategy
      }
    } catch (e) {
      console.error('Failed to load player strategy:', e)
      ElMessage.error('åŠ è½½é€‰æ‰‹ç­–ç•¥å¤±è´¥')
    } finally {
      loadingStrategyId.value = null
    }
  }
}

// æŸ¥çœ‹çƒé˜Ÿç­–ç•¥
const handleViewTeamStrategy = async (teamId: number) => {
  try {
    const strategy = await llmMarketApi.getTeamStrategy(teamId)
    if (strategy) {
      currentTeamStrategy.value = strategy
      activeTab.value = 'strategies'
    } else {
      ElMessage.warning('è¯¥çƒé˜Ÿæš‚æ— ç­–ç•¥æ•°æ®')
    }
  } catch (e) {
    console.error('Failed to load team strategy:', e)
    ElMessage.error('åŠ è½½çƒé˜Ÿç­–ç•¥å¤±è´¥')
  }
}

// åˆ‡æ¢ç»­çº¦è¯¦æƒ…å±•å¼€çŠ¶æ€
const handleToggleRenewalExpand = (playerId: number) => {
  if (expandedRenewalId.value === playerId) {
    expandedRenewalId.value = null
  } else {
    expandedRenewalId.value = playerId
  }
}

// è·å– impact æ ‡ç­¾ç±»å‹
const getImpactTagType = (impact: string): string => {
  if (impact.includes('æ­£é¢') || impact.includes('ç§¯æ') || impact.includes('æ»¡æ„') || impact.includes('æ„¿æ„') || impact.includes('+')) {
    return 'success'
  }
  if (impact.includes('è´Ÿé¢') || impact.includes('æ¶ˆæ') || impact.includes('ä¸æ»¡') || impact.includes('æ‹’ç»') || impact.includes('-')) {
    return 'danger'
  }
  if (impact.includes('ä¸­æ€§') || impact.includes('ä¸­ç«‹') || impact.includes('æ— ')) {
    return 'info'
  }
  return 'warning'
}

// è·å–ç­–ç•¥ç±»å‹çš„æ ‡ç­¾é¢œè‰²
const getStrategyTagType = (strategy: string): string => {
  const types: Record<string, string> = {
    'AggressiveBuy': 'danger',
    'StarHunting': 'warning',
    'YouthDevelopment': 'success',
    'Balanced': 'primary',
    'Passive': 'info',
    'MustSell': 'warning',
    'ForceClear': 'danger',
    'FullRebuild': 'info',
  }
  return types[strategy] || 'info'
}

// è·å–åˆ†ææ­¥éª¤å½±å“ç±»å‹çš„æ ‡ç­¾é¢œè‰²
const getStepImpactType = (impact: string): string => {
  if (impact.includes('æ­£é¢') || impact.includes('å¢åŠ ') || impact.includes('+')) return 'success'
  if (impact.includes('è´Ÿé¢') || impact.includes('å‡å°‘') || impact.includes('-')) return 'danger'
  if (impact.includes('ä¸­æ€§') || impact.includes('æ— ')) return 'info'
  return 'warning'
}

// è¾…åŠ©å‡½æ•°
const getPhaseDisplayName = (phase: MarketPhase | undefined): string => {
  if (!phase) return ''
  return PHASE_NAMES[phase] || phase
}

const getPositionClass = (position: string | null | undefined): string => {
  if (!position) return 'unknown'
  const pos = position.toLowerCase()
  if (pos === 'top') return 'top'
  if (pos === 'jug' || pos === 'jungle') return 'jungle'
  if (pos === 'mid') return 'mid'
  if (pos === 'adc' || pos === 'bot') return 'adc'
  if (pos === 'sup' || pos === 'support') return 'support'
  return 'unknown'
}

const getAbilityClass = (ability: number): string => {
  if (ability >= 90) return 'ability-legendary'
  if (ability >= 80) return 'ability-elite'
  if (ability >= 70) return 'ability-good'
  return 'ability-normal'
}

const getStatusTagType = (status: string): string => {
  const types: Record<string, string> = {
    'OPEN': 'primary',
    'ACCEPTED': 'success',
    'REJECTED': 'danger',
    'EXPIRED': 'info',
    'WITHDRAWN': 'warning',
  }
  return types[status] || 'info'
}

const getOfferStatusTagType = (status: string): string => {
  const types: Record<string, string> = {
    'PENDING': 'warning',
    'ACCEPTED': 'success',
    'REJECTED': 'danger',
    'COUNTERED': 'primary',
    'WITHDRAWN': 'info',
    'EXPIRED': 'info',
  }
  return types[status] || 'info'
}

const getEventClass = (eventType: string): string => {
  if (eventType === 'SIGNING_COMPLETED') return 'event-signing'
  if (eventType === 'TRANSFER_REQUESTED') return 'event-transfer'
  if (eventType === 'OFFER_ACCEPTED') return 'event-accepted'
  if (eventType === 'OFFER_REJECTED') return 'event-rejected'
  if (eventType === 'TEAM_THINKING' || eventType === 'PLAYER_THINKING') return 'event-thinking'
  return 'event-default'
}

const getTimelineItemType = (eventType: string): string => {
  if (eventType === 'ACCEPTED') return 'success'
  if (eventType === 'REJECTED') return 'danger'
  if (eventType === 'OFFER_RECEIVED') return 'primary'
  return 'info'
}

const formatSalary = (value: number): string => {
  // æ™ºèƒ½å¤„ç†è–ªèµ„å•ä½é—®é¢˜ï¼š
  // åç«¯çº¦å®šè–ªèµ„å•ä½ä¸º"ä¸‡"ï¼Œä½† LLM å¯èƒ½è¿”å›"å…ƒ"
  // å¦‚æœæ•°å€¼ >= 100000ï¼Œå¾ˆå¯èƒ½æ˜¯å…ƒä¸ºå•ä½ï¼ˆå¦‚ 1250000 è¡¨ç¤º 125ä¸‡ï¼‰
  // è½¬æ¢ä¸ºä¸‡åå†æ ¼å¼åŒ–
  let valueInWan = value
  if (value >= 100000) {
    // å¯èƒ½æ˜¯å…ƒä¸ºå•ä½ï¼Œè½¬æ¢ä¸ºä¸‡
    valueInWan = value / 10000
  }

  if (valueInWan >= 10000) return `${(valueInWan / 10000).toFixed(1)}äº¿`
  if (valueInWan >= 1) return `${Math.round(valueInWan)}ä¸‡`
  return `${valueInWan}ä¸‡`
}

// ==================== æ€è€ƒè¿‡ç¨‹ç›¸å…³å‡½æ•° ====================

// åˆ¤æ–­æ˜¯å¦ä¸ºæ€è€ƒç±»äº‹ä»¶
const isThinkingEvent = (eventType: string): boolean => {
  return eventType === 'TEAM_THINKING' || eventType === 'PLAYER_THINKING'
}

// æˆªæ–­æ–‡æœ¬
const truncateText = (text: string, maxLength: number): string => {
  if (!text || text.length <= maxLength) return text
  return text.substring(0, maxLength) + '...'
}

// ç‚¹å‡»äº‹ä»¶å¡ç‰‡
const handleEventClick = (event: any) => {
  if (isThinkingEvent(event.event_type)) {
    selectedThinkingEvent.value = event
    thinkingDialogVisible.value = true
  }
}
</script>

<style scoped>
.llm-transfer-market {
  padding: 0;
}

/* é¡µé¢æ ‡é¢˜ */
.page-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 20px;
}

.page-header h1 {
  font-size: 24px;
  font-weight: 700;
  color: #303133;
  margin: 0 0 8px 0;
}

.page-header p {
  font-size: 14px;
  color: #909399;
  margin: 0;
}

/* ä½¿ç”¨è¯´æ˜å¡ç‰‡ */
.guide-card {
  margin-bottom: 20px;
  border-radius: 12px;
  border-left: 4px solid #409eff;
  background: linear-gradient(135deg, #f0f7ff, #f5f7fa);
}

.guide-header {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 16px;
  font-weight: 600;
  color: #409eff;
}

.guide-content {
  font-size: 14px;
  color: #606266;
  line-height: 1.8;
}

.guide-content h4 {
  font-size: 15px;
  font-weight: 600;
  color: #303133;
  margin: 0 0 12px 0;
  padding-bottom: 8px;
  border-bottom: 1px solid #ebeef5;
}

.guide-content ul,
.guide-content ol {
  padding-left: 20px;
  margin: 0 0 20px 0;
}

.guide-content li {
  margin-bottom: 8px;
}

.guide-content :deep(.el-timeline) {
  padding-left: 0;
}

.guide-content :deep(.el-timeline-item__content) {
  font-size: 13px;
}

.guide-content :deep(.el-alert) {
  margin-top: 16px;
}

.header-actions {
  display: flex;
  gap: 12px;
  align-items: center;
}

/* é˜¶æ®µå¡ç‰‡ */
.phase-card {
  margin-bottom: 20px;
  border-radius: 12px;
}

.phase-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.phase-title {
  font-size: 15px;
  font-weight: 600;
  color: #303133;
}

.phase-text {
  font-size: 13px;
  color: #606266;
}

/* ç»Ÿè®¡å¡ç‰‡ */
.stats-row {
  margin-bottom: 20px;
}

.stat-card {
  border-radius: 12px;
  transition: all 0.3s ease;
}

.stat-content {
  display: flex;
  align-items: center;
  gap: 12px;
}

.stat-icon {
  width: 48px;
  height: 48px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
}

.stat-icon.blue { background: linear-gradient(135deg, #3b82f6, #2563eb); }
.stat-icon.green { background: linear-gradient(135deg, #22c55e, #16a34a); }
.stat-icon.orange { background: linear-gradient(135deg, #f59e0b, #d97706); }
.stat-icon.purple { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }

.stat-info { flex: 1; }

.stat-number {
  font-size: 24px;
  font-weight: 700;
  color: #303133;
  line-height: 1;
}

.stat-label {
  font-size: 13px;
  color: #909399;
  margin-top: 4px;
}

/* æ“ä½œæŒ‰é’® */
.action-bar {
  display: flex;
  gap: 12px;
  margin-bottom: 20px;
}

/* è¿›åº¦å¡ç‰‡ */
.progress-card {
  margin-bottom: 20px;
  border-radius: 12px;
  border-left: 4px solid #409eff;
}

.progress-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.progress-title {
  font-size: 15px;
  font-weight: 600;
  color: #303133;
}

.progress-text {
  font-size: 14px;
  color: #606266;
}

.progress-item {
  margin-top: 8px;
  font-size: 13px;
  color: #606266;
}

/* è½®æ¬¡ç»“æœå¡ç‰‡ */
.round-result-card {
  margin-bottom: 20px;
  border-radius: 12px;
  border-left: 4px solid #67c23a;
  background: linear-gradient(135deg, #f0f9eb, #f4f4f5);
}

.round-result-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.round-badge {
  padding: 4px 12px;
  background: #67c23a;
  color: white;
  font-size: 12px;
  font-weight: 600;
  border-radius: 4px;
}

.round-phase {
  font-size: 14px;
  color: #606266;
}

.round-result-content {
  font-size: 14px;
  color: #606266;
  margin-bottom: 16px;
}

.round-stats {
  display: flex;
  gap: 24px;
}

/* ç»­çº¦ç»“æœå¡ç‰‡ */
.renewal-result-card {
  margin-bottom: 20px;
  border-radius: 12px;
  border-left: 4px solid #409eff;
  background: linear-gradient(135deg, #f0f7ff, #f5f7fa);
}

.renewal-result-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.renewal-badge {
  padding: 4px 12px;
  background: #409eff;
  color: white;
  font-size: 12px;
  font-weight: 600;
  border-radius: 4px;
}

.renewal-stats-inline {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
}

.stat-success { color: #67c23a; font-weight: 600; }
.stat-warning { color: #e6a23c; font-weight: 600; }
.stat-danger { color: #f56c6c; font-weight: 600; }
.stat-separator { color: #dcdfe6; }

.renewal-decisions-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.renewal-decision-item {
  background: white;
  border-radius: 8px;
  padding: 12px;
  border-left: 3px solid #409eff;
}

.renewal-decision-item.success {
  border-left-color: #67c23a;
}

.renewal-decision-item.team-reject {
  border-left-color: #e6a23c;
}

.renewal-decision-item.player-reject {
  border-left-color: #f56c6c;
}

.decision-main {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 8px;
}

.decision-main .player-name {
  font-size: 14px;
  font-weight: 600;
  color: #303133;
}

.decision-main .team-name {
  font-size: 13px;
  color: #909399;
}

.decision-result {
  margin-bottom: 6px;
}

.decision-summary {
  font-size: 12px;
  color: #606266;
  line-height: 1.5;
}

.more-hint {
  text-align: center;
  font-size: 12px;
  color: #909399;
  padding: 8px;
}

.round-stat {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
}

.round-stat .stat-value {
  font-size: 20px;
  font-weight: 700;
  color: #67c23a;
}

.round-stat .stat-label {
  font-size: 12px;
  color: #909399;
}

.round-stat.phase-changed .stat-value {
  font-size: 14px;
  color: #f59e0b;
}

/* Tabs */
.content-tabs {
  margin-bottom: 20px;
}

.tab-toolbar {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
}

.count-badge {
  font-size: 13px;
  color: #909399;
  margin-left: auto;
}

/* ç¦»é˜Ÿå€™é€‰äºº */
.departure-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.departure-card {
  background: white;
  border: 1px solid #ebeef5;
  border-radius: 10px;
  transition: all 0.3s ease;
  cursor: pointer;
}

.departure-card:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.departure-card.expanded {
  border-color: #409eff;
  box-shadow: 0 4px 16px rgba(64, 158, 255, 0.15);
}

.departure-card-main {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 16px;
}

.departure-tags {
  display: flex;
  gap: 8px;
  margin-bottom: 4px;
}

.expand-icon {
  color: #909399;
  transition: transform 0.3s ease;
}

.expand-icon .rotate {
  transform: rotate(180deg);
}

/* åˆ†æè¯¦æƒ…å±•å¼€åŒºåŸŸ */
.analysis-detail {
  padding: 0 16px 16px;
  border-top: 1px solid #ebeef5;
  margin-top: 0;
}

.loading-analysis {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 24px;
  color: #909399;
}

/* æ–°çš„åˆ†æå†…å®¹å¸ƒå±€ */
.analysis-content-wrapper {
  padding-top: 16px;
}

.analysis-header {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 1px solid #ebeef5;
}

.leave-reasoning-box {
  flex: 1;
  font-size: 13px;
  color: #606266;
  line-height: 1.6;
  padding: 8px 12px;
  background: #fdf6ec;
  border-radius: 6px;
  border-left: 3px solid #e6a23c;
}

.leave-reasoning-box strong {
  color: #e6a23c;
}

.analysis-content {
  margin: 0 -8px;
}

.analysis-card {
  background: #f8f9fa;
  border-radius: 10px;
  padding: 16px;
  height: 100%;
  min-height: 200px;
}

.card-header {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 14px;
  font-weight: 600;
  color: #303133;
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 1px solid #e4e7ed;
}

.card-header .el-icon {
  color: #409eff;
}

/* LLM/Mock æ ‡è¯† */
.source-badge {
  font-size: 12px;
  font-weight: 600;
  flex-shrink: 0;
}

.source-badge.llm {
  background: linear-gradient(135deg, #67c23a, #529b2e);
  border-color: #67c23a;
}

.source-badge.mock {
  background: #f5f7fa;
  border-color: #dcdfe6;
  color: #909399;
}

/* åˆåŒæœŸæœ› */
.contract-expectations {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.expectation-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 10px;
  background: white;
  border-radius: 6px;
}

.expectation-item .label {
  font-size: 13px;
  color: #606266;
}

.expectation-item .value {
  font-size: 14px;
  font-weight: 600;
  color: #303133;
}

.expectation-item .value.highlight {
  color: #409eff;
  font-size: 15px;
}

.expectation-item .value.require-yes {
  color: #e6a23c;
}

/* åå¥½çƒé˜Ÿ */
.preferred-teams {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.preferred-team {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  background: white;
  border-radius: 6px;
}

.team-rank {
  font-size: 12px;
  font-weight: 700;
  color: #f59e0b;
  width: 24px;
}

.preferred-team .team-name {
  flex: 1;
  font-size: 13px;
  color: #303133;
}

/* åˆ†ææ­¥éª¤ */
.analysis-steps {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.analysis-step {
  background: white;
  border-radius: 6px;
  padding: 10px;
  border-left: 3px solid #409eff;
}

.step-header {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}

.step-number {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #409eff;
  color: white;
  font-size: 10px;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
}

.step-name {
  font-size: 12px;
  font-weight: 600;
  color: #303133;
}

.step-result {
  font-size: 12px;
  color: #606266;
  line-height: 1.4;
}

.empty-state {
  text-align: center;
  padding: 20px;
  color: #909399;
  font-size: 13px;
}

/* æ—§çš„æ ·å¼ä¿ç•™ä¾›çƒé˜Ÿç­–ç•¥ä½¿ç”¨ */
.analysis-section {
  background: #f5f7fa;
  border-radius: 8px;
  padding: 16px;
}

.analysis-section h4 {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 14px;
  font-weight: 600;
  color: #303133;
  margin: 0 0 12px 0;
  padding-bottom: 8px;
  border-bottom: 1px solid #e4e7ed;
}

/* åˆ†ææ­¥éª¤ */
.analysis-steps {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.analysis-step {
  background: white;
  border-radius: 6px;
  padding: 10px;
  border-left: 3px solid #409eff;
}

.step-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
}

.step-number {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: #409eff;
  color: white;
  font-size: 11px;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
}

.step-name {
  font-size: 13px;
  font-weight: 600;
  color: #303133;
  flex: 1;
}

.step-detail {
  font-size: 12px;
  color: #606266;
}

.step-row {
  display: flex;
  gap: 8px;
  margin-bottom: 4px;
}

.step-label {
  color: #909399;
  flex-shrink: 0;
}

.step-value {
  color: #606266;
}

.step-value.result {
  font-weight: 500;
  color: #303133;
}

.no-steps, .no-teams {
  text-align: center;
  padding: 16px;
  color: #909399;
  font-size: 13px;
}

/* åå¥½çƒé˜Ÿ */
.preferred-teams {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.preferred-team {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px;
  background: white;
  border-radius: 6px;
}

.team-rank {
  font-size: 12px;
  font-weight: 700;
  color: #f59e0b;
  width: 24px;
}

.preferred-team .team-name {
  flex: 1;
  font-size: 13px;
  color: #303133;
}

.preference-reasoning {
  margin-top: 12px;
  font-size: 12px;
  color: #606266;
  line-height: 1.5;
  padding: 8px;
  background: white;
  border-radius: 6px;
}

/* åˆåŒæœŸæœ› */
.contract-expectations {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.expectation-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px;
  background: white;
  border-radius: 6px;
}

.expectation-item .label {
  font-size: 13px;
  color: #606266;
}

.expectation-item .value {
  font-size: 14px;
  font-weight: 600;
  color: #409eff;
}

.player-avatar {
  width: 48px;
  height: 48px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 700;
  font-size: 12px;
  flex-shrink: 0;
}

.player-avatar.large {
  width: 64px;
  height: 64px;
  font-size: 14px;
}

.player-avatar.top { background: linear-gradient(135deg, #ef4444, #dc2626); }
.player-avatar.jungle { background: linear-gradient(135deg, #22c55e, #16a34a); }
.player-avatar.mid { background: linear-gradient(135deg, #3b82f6, #2563eb); }
.player-avatar.adc { background: linear-gradient(135deg, #f59e0b, #d97706); }
.player-avatar.support { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
.player-avatar.unknown { background: linear-gradient(135deg, #9ca3af, #6b7280); }

.player-info {
  flex: 1;
  min-width: 0;
}

.player-name {
  font-size: 15px;
  font-weight: 600;
  color: #303133;
}

.player-name.large {
  font-size: 18px;
}

.player-meta {
  font-size: 13px;
  color: #909399;
  margin-top: 2px;
}

.departure-reason {
  flex: 2;
}

.reason-text {
  font-size: 13px;
  color: #606266;
  margin-top: 4px;
  line-height: 1.4;
}

.expected-salary {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
}

.salary-value {
  font-size: 18px;
  font-weight: 700;
  color: #409eff;
}

.salary-label {
  font-size: 12px;
  color: #909399;
}

/* è¡¨æ ¼æ ·å¼ */
.player-cell {
  display: flex;
  align-items: center;
  gap: 8px;
}

.position-tag {
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 11px;
  font-weight: 600;
  color: white;
}

.position-tag.top { background: #ef4444; }
.position-tag.jungle { background: #22c55e; }
.position-tag.mid { background: #3b82f6; }
.position-tag.adc { background: #f59e0b; }
.position-tag.support { background: #8b5cf6; }
.position-tag.unknown { background: #9ca3af; }

.ability-legendary { color: #ef4444; font-weight: 700; }
.ability-elite { color: #f59e0b; font-weight: 700; }
.ability-good { color: #3b82f6; font-weight: 600; }
.ability-normal { color: #22c55e; }

.roster-warning { color: #f56c6c; font-weight: 600; }
.text-muted { color: #c0c4cc; }

/* äº‹ä»¶åˆ—è¡¨ */
.events-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.event-card {
  display: flex;
  gap: 12px;
  padding: 16px;
  background: white;
  border: 1px solid #ebeef5;
  border-radius: 10px;
  border-left: 4px solid #409eff;
}

.event-card.event-signing { border-left-color: #67c23a; }
.event-card.event-transfer { border-left-color: #f59e0b; }
.event-card.event-accepted { border-left-color: #67c23a; }
.event-card.event-rejected { border-left-color: #f56c6c; }

.event-icon {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  flex-shrink: 0;
  background: #409eff;
}

.event-icon.event-signing { background: #67c23a; }
.event-icon.event-transfer { background: #f59e0b; }
.event-icon.event-accepted { background: #67c23a; }
.event-icon.event-rejected { background: #f56c6c; }

.event-content {
  flex: 1;
}

.event-title {
  font-size: 14px;
  font-weight: 600;
  color: #303133;
  margin-bottom: 4px;
}

.event-desc {
  font-size: 13px;
  color: #606266;
  margin-bottom: 8px;
}

.event-meta {
  display: flex;
  gap: 12px;
  font-size: 12px;
  color: #909399;
}

/* è°ˆåˆ¤è¯¦æƒ…å¼¹çª— */
.negotiation-detail {
  padding: 0 8px;
}

.detail-header {
  display: flex;
  align-items: center;
  gap: 16px;
  padding-bottom: 20px;
  border-bottom: 1px solid #ebeef5;
  margin-bottom: 20px;
}

.offers-section h4,
.timeline-section h4 {
  font-size: 15px;
  font-weight: 600;
  color: #303133;
  margin: 0 0 16px 0;
}

.team-offer-history {
  margin-bottom: 16px;
  padding: 12px;
  background: #f5f7fa;
  border-radius: 8px;
}

.team-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 12px;
}

.team-header .team-name {
  font-weight: 600;
  color: #303133;
}

.offer-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px 0;
  border-bottom: 1px solid #ebeef5;
}

.offer-item:last-child {
  border-bottom: none;
}

.offer-round {
  font-size: 12px;
  color: #909399;
  width: 50px;
}

.offer-content {
  flex: 1;
  display: flex;
  gap: 12px;
  align-items: center;
}

.offer-content .salary {
  font-weight: 600;
  color: #409eff;
}

.offer-content .years {
  color: #606266;
}

.timeline-section {
  margin-top: 20px;
}

.timeline-content .timeline-title {
  font-size: 14px;
  color: #303133;
}

.timeline-content .timeline-details {
  font-size: 13px;
  color: #606266;
  margin-top: 4px;
}

/* çƒé˜Ÿç­–ç•¥è¯¦æƒ… */
.team-strategy-detail {
  padding: 0;
}

.strategy-header {
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 1px solid #ebeef5;
}

.strategy-header .team-info {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.strategy-header .team-info h3 {
  font-size: 20px;
  font-weight: 700;
  color: #303133;
  margin: 0;
}

.strategy-description {
  font-size: 14px;
  color: #606266;
  line-height: 1.6;
}

.strategy-content {
  margin-bottom: 24px;
}

.strategy-section {
  background: #f5f7fa;
  border-radius: 10px;
  padding: 16px;
  height: 100%;
}

.strategy-section h4 {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 15px;
  font-weight: 600;
  color: #303133;
  margin: 0 0 16px 0;
  padding-bottom: 10px;
  border-bottom: 1px solid #e4e7ed;
}

.targets-list,
.sell-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.target-item,
.sell-item {
  background: white;
  border-radius: 8px;
  padding: 12px;
  border-left: 3px solid #409eff;
}

.sell-item {
  border-left-color: #f56c6c;
}

.target-main,
.sell-main {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
}

.target-main .player-name,
.sell-main .player-name {
  font-weight: 600;
  color: #303133;
  flex: 1;
}

.target-main .ability,
.sell-main .ability {
  font-size: 13px;
  color: #909399;
}

.target-details,
.sell-details {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 8px;
}

.target-details .budget,
.sell-details .price {
  font-size: 13px;
  color: #409eff;
  font-weight: 500;
}

.target-reasoning,
.sell-reasoning {
  font-size: 12px;
  color: #606266;
  line-height: 1.5;
  padding-top: 8px;
  border-top: 1px dashed #ebeef5;
}

.empty-list {
  text-align: center;
  padding: 24px;
  color: #909399;
  font-size: 13px;
}

/* é¢„ç®—åˆ†é… */
.budget-section {
  background: #f5f7fa;
  border-radius: 10px;
  padding: 16px;
  margin-bottom: 24px;
}

.budget-section h4 {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 15px;
  font-weight: 600;
  color: #303133;
  margin: 0 0 16px 0;
}

.budget-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
}

.budget-item {
  background: white;
  border-radius: 8px;
  padding: 12px;
  text-align: center;
}

.budget-item .label {
  display: block;
  font-size: 12px;
  color: #909399;
  margin-bottom: 4px;
}

.budget-item .value {
  display: block;
  font-size: 18px;
  font-weight: 700;
  color: #409eff;
}

/* çƒé˜Ÿåˆ†ææ­¥éª¤ */
.team-analysis {
  background: #f5f7fa;
  border-radius: 10px;
  padding: 16px;
  margin-bottom: 24px;
}

.team-analysis h4 {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 15px;
  font-weight: 600;
  color: #303133;
  margin: 0 0 16px 0;
}

/* ç­–ç•¥è¯´æ˜ */
.reasoning-section {
  background: linear-gradient(135deg, #f0f7ff, #f5f7fa);
  border-radius: 10px;
  padding: 16px;
  border-left: 4px solid #409eff;
}

.reasoning-section h4 {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 15px;
  font-weight: 600;
  color: #409eff;
  margin: 0 0 12px 0;
}

.reasoning-text {
  font-size: 14px;
  color: #606266;
  line-height: 1.8;
}

/* ==================== ç»­çº¦ç»“æœ Tab æ ·å¼ ==================== */

.renewals-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.renewal-card {
  background: white;
  border-radius: 12px;
  border: 1px solid #ebeef5;
  transition: all 0.3s ease;
  overflow: hidden;
}

.renewal-card:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.renewal-card.success {
  border-left: 4px solid #67c23a;
}

.renewal-card.team-reject {
  border-left: 4px solid #e6a23c;
}

.renewal-card.player-reject {
  border-left: 4px solid #f56c6c;
}

.renewal-card.expanded {
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
}

.renewal-card-main {
  display: flex;
  align-items: center;
  padding: 16px 20px;
  cursor: pointer;
  gap: 16px;
}

.renewal-card-main:hover {
  background: #fafafa;
}

.renewal-status-icon {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.renewal-status-icon.success {
  background: linear-gradient(135deg, #67c23a, #85ce61);
  color: white;
}

.renewal-status-icon.team-reject {
  background: linear-gradient(135deg, #e6a23c, #f0b050);
  color: white;
}

.renewal-status-icon.player-reject {
  background: linear-gradient(135deg, #f56c6c, #f78989);
  color: white;
}

.renewal-player-info {
  flex: 1;
  min-width: 0;
}

.renewal-player-info .renewal-player-name {
  font-size: 15px;
  font-weight: 600;
  color: #303133;
  margin-bottom: 6px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.renewal-player-info .renewal-team-name {
  font-size: 13px;
  color: #606266;
  display: flex;
  align-items: center;
  gap: 6px;
}

.renewal-player-info .name-icon {
  font-size: 14px;
}

.renewal-player-info .name-icon.player {
  color: #409eff;
}

.renewal-player-info .name-icon.team {
  color: #e6a23c;
}

.renewal-result-tag {
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 500;
}

.renewal-result-tag.success {
  background: #f0f9eb;
  color: #67c23a;
}

.renewal-result-tag.team-reject {
  background: #fdf6ec;
  color: #e6a23c;
}

.renewal-result-tag.player-reject {
  background: #fef0f0;
  color: #f56c6c;
}

.renewal-contract-preview {
  display: flex;
  align-items: center;
  gap: 12px;
  color: #606266;
  font-size: 13px;
}

.renewal-contract-preview .contract-item {
  display: flex;
  align-items: center;
  gap: 4px;
}

.renewal-contract-preview .value {
  font-weight: 600;
  color: #409eff;
}

.renewal-expand-btn {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: #f5f7fa;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #909399;
  transition: all 0.3s ease;
  flex-shrink: 0;
}

.renewal-expand-btn.expanded {
  background: #409eff;
  color: white;
  transform: rotate(90deg);
}

/* ç»­çº¦è¯¦æƒ…å±•å¼€åŒºåŸŸ */
.renewal-detail {
  padding: 20px;
  background: linear-gradient(to bottom, #f8f9fc, #ffffff);
  border-top: 1px solid #ebeef5;
}

/* è¯¦æƒ…é¡¶éƒ¨ä¿¡æ¯æ  */
.detail-header {
  display: flex;
  gap: 16px;
  margin-bottom: 16px;
}

.contract-info-card {
  flex: 1;
  background: white;
  border-radius: 12px;
  padding: 16px;
  border: 1px solid #e4e7ed;
}

.contract-info-card .info-title {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  font-weight: 600;
  color: #606266;
  margin-bottom: 12px;
}

.contract-info-card .info-content {
  display: flex;
  gap: 24px;
}

.contract-info-card .info-item {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.contract-info-card .info-item .label {
  font-size: 12px;
  color: #909399;
}

.contract-info-card .info-item .value {
  font-size: 18px;
  font-weight: 700;
  color: #303133;
}

.contract-info-card .info-item .value.salary {
  color: #409eff;
}

.result-status-card {
  width: 120px;
  border-radius: 12px;
  padding: 16px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.result-status-card.success {
  background: linear-gradient(135deg, #f0f9eb, #e1f3d8);
  border: 1px solid #b3e19d;
}

.result-status-card.team-reject {
  background: linear-gradient(135deg, #fdf6ec, #faecd8);
  border: 1px solid #f3d19e;
}

.result-status-card.player-reject {
  background: linear-gradient(135deg, #fef0f0, #fde2e2);
  border: 1px solid #fab6b6;
}

.result-status-card .status-icon {
  font-size: 28px;
}

.result-status-card.success .status-icon { color: #67c23a; }
.result-status-card.team-reject .status-icon { color: #e6a23c; }
.result-status-card.player-reject .status-icon { color: #f56c6c; }

.result-status-card .status-text {
  font-size: 13px;
  font-weight: 600;
}

.result-status-card.success .status-text { color: #67c23a; }
.result-status-card.team-reject .status-text { color: #e6a23c; }
.result-status-card.player-reject .status-text { color: #f56c6c; }

/* æ‘˜è¦å¡ç‰‡ */
.summary-card {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  background: linear-gradient(135deg, #ecf5ff, #f5f7fa);
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 16px;
  border-left: 4px solid #409eff;
}

.summary-card .summary-icon {
  color: #409eff;
  font-size: 20px;
  flex-shrink: 0;
  margin-top: 2px;
}

.summary-card .summary-text {
  font-size: 14px;
  color: #606266;
  line-height: 1.6;
}

/* æ‹’ç»åŸå› å¡ç‰‡ */
.rejection-card {
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 16px;
}

.rejection-card.team-reject {
  background: linear-gradient(135deg, #fdf6ec, #fff8e6);
  border-left: 4px solid #e6a23c;
}

.rejection-card.player-reject {
  background: linear-gradient(135deg, #fef0f0, #fff5f5);
  border-left: 4px solid #f56c6c;
}

.rejection-card .rejection-header {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 10px;
}

.rejection-card.team-reject .rejection-header { color: #e6a23c; }
.rejection-card.player-reject .rejection-header { color: #f56c6c; }

.rejection-card .rejection-content {
  font-size: 14px;
  color: #606266;
  line-height: 1.6;
  padding-left: 28px;
}

/* AI åˆ†æéƒ¨åˆ† */
.analysis-section {
  margin-top: 8px;
}

.analysis-section .section-title {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 15px;
  font-weight: 600;
  color: #303133;
  margin-bottom: 16px;
}

.analysis-section .section-title .el-icon {
  color: #409eff;
}

.analysis-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

.analysis-card {
  background: white;
  border-radius: 12px;
  border: 1px solid #e4e7ed;
  overflow: hidden;
}

.analysis-card .card-header {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 14px 16px;
  background: #f5f7fa;
  border-bottom: 1px solid #e4e7ed;
  font-size: 14px;
  font-weight: 600;
  color: #303133;
}

.analysis-card.team-side .card-header .el-icon { color: #e6a23c; }
.analysis-card.player-side .card-header .el-icon { color: #409eff; }

.analysis-card .card-header span {
  flex: 1;
}

.steps-container {
  padding: 12px;
  max-height: 320px;
  overflow-y: auto;
}

.step-item {
  display: flex;
  gap: 12px;
  padding: 12px;
  background: #fafbfc;
  border-radius: 8px;
  margin-bottom: 10px;
}

.step-item:last-child {
  margin-bottom: 0;
}

.step-num {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: #409eff;
  color: white;
  font-size: 12px;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.analysis-card.team-side .step-num { background: #e6a23c; }
.analysis-card.player-side .step-num { background: #409eff; }

.step-content {
  flex: 1;
  min-width: 0;
}

.step-content .step-title {
  font-size: 13px;
  font-weight: 600;
  color: #303133;
  margin-bottom: 6px;
}

.step-content .step-data {
  font-size: 12px;
  color: #909399;
  background: white;
  padding: 6px 10px;
  border-radius: 4px;
  margin-bottom: 6px;
  border: 1px solid #ebeef5;
}

.step-content .step-result {
  font-size: 13px;
  color: #606266;
  line-height: 1.5;
  margin-bottom: 6px;
}

.step-content .step-tag {
  margin-top: 4px;
}

.no-data {
  padding: 32px;
  text-align: center;
  color: #909399;
  font-size: 13px;
}

/* å“åº”å¼ */
@media (max-width: 900px) {
  .analysis-grid {
    grid-template-columns: 1fr;
  }

  .detail-header {
    flex-direction: column;
  }

  .result-status-card {
    width: 100%;
    flex-direction: row;
    justify-content: center;
  }
}

/* ç©ºçŠ¶æ€ */
.renewals-empty {
  text-align: center;
  padding: 60px 20px;
}

.renewals-empty .el-icon {
  font-size: 48px;
  color: #c0c4cc;
  margin-bottom: 16px;
}

.renewals-empty p {
  color: #909399;
  font-size: 14px;
  margin: 0;
}

/* å“åº”å¼é€‚é… */
@media (max-width: 768px) {
  .renewal-analysis-row {
    grid-template-columns: 1fr;
  }

  .renewal-card-main {
    flex-wrap: wrap;
    gap: 12px;
  }

  .renewal-contract-preview {
    width: 100%;
    justify-content: flex-start;
  }
}

/* ==================== æ€è€ƒè¿‡ç¨‹ç›¸å…³æ ·å¼ ==================== */

/* å¯ç‚¹å‡»çš„äº‹ä»¶å¡ç‰‡ */
.event-card.clickable {
  cursor: pointer;
  transition: all 0.2s ease;
}

.event-card.clickable:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
  border-color: #409eff;
}

/* æ€è€ƒç±»äº‹ä»¶ç‰¹æ®Šæ ·å¼ */
.event-card.event-thinking {
  border-left-color: #8b5cf6;
  background: linear-gradient(to right, #f5f3ff, white);
}

.event-icon.event-thinking {
  background: linear-gradient(135deg, #8b5cf6, #7c3aed);
}

.thinking-tag {
  margin-left: 8px;
  font-size: 11px;
}

.event-desc.truncated {
  max-height: 60px;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

/* æ€è€ƒå¼¹çª—æ ·å¼ */
.thinking-dialog :deep(.el-dialog__body) {
  padding: 16px 24px 24px;
}

.thinking-content {
  padding: 0;
}

.thinking-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 1px solid #ebeef5;
}

.thinking-round {
  font-size: 13px;
  color: #909399;
}

.thinking-info {
  display: flex;
  gap: 20px;
  margin-bottom: 16px;
  padding: 12px 16px;
  background: #f5f7fa;
  border-radius: 8px;
}

.thinking-info .info-item {
  display: flex;
  gap: 8px;
}

.thinking-info .label {
  color: #909399;
  font-size: 13px;
}

.thinking-info .value {
  color: #303133;
  font-size: 13px;
  font-weight: 500;
}

.thinking-body {
  background: linear-gradient(135deg, #f0f7ff, #f5f7fa);
  border-radius: 12px;
  padding: 16px;
  border-left: 4px solid #409eff;
}

.thinking-title {
  font-size: 14px;
  font-weight: 600;
  color: #303133;
  margin-bottom: 12px;
}

.thinking-text {
  font-size: 14px;
  color: #606266;
  line-height: 1.8;
  white-space: pre-wrap;
  word-break: break-word;
  margin: 0;
  font-family: inherit;
  background: white;
  padding: 16px;
  border-radius: 8px;
  max-height: 400px;
  overflow-y: auto;
}

/* æˆ˜é˜Ÿæ€è€ƒå’Œé€‰æ‰‹æ€è€ƒçš„ä¸åŒä¸»é¢˜ */
.thinking-body.team-thinking {
  border-left-color: #e6a23c;
  background: linear-gradient(135deg, #fdf6ec, #fef8f0);
}

.thinking-body.player-thinking {
  border-left-color: #409eff;
  background: linear-gradient(135deg, #ecf5ff, #f0f7ff);
}
</style>
